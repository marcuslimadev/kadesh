import{r as e,c as a,B as t,o as r,a as o,e as s,j as l,C as n,K as i,q as d,t as c,F as u,l as m,h as v,u as p,b,n as g,p as f,k as h}from"./vue-NU_yXd1p.js";import{_ as x}from"./Pagination-CPcQ3YY2.js";import{a as y}from"./index-D_Cw222X.js";import{b as k}from"./utils-CeLII1lI.js";import{l as A}from"./index-Ctu0mvSg.js";const w={async getNotifications(e={}){var a,t;try{return{success:!0,data:(await y.get("/api/notifications",{params:e})).data}}catch(r){return console.error("Error fetching notifications:",r),{success:!1,error:(null==(t=null==(a=r.response)?void 0:a.data)?void 0:t.error)||"Erro ao carregar notificações"}}},async markAsRead(e){var a,t;try{return{success:!0,data:(await y.patch(`/api/notifications/${e}/read`)).data}}catch(r){return console.error("Error marking notification as read:",r),{success:!1,error:(null==(t=null==(a=r.response)?void 0:a.data)?void 0:t.error)||"Erro ao marcar notificação como lida"}}},async markAllAsRead(){var e,a;try{return{success:!0,data:(await y.post("/api/notifications/read-all")).data}}catch(t){return console.error("Error marking all as read:",t),{success:!1,error:(null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.error)||"Erro ao marcar todas como lidas"}}},async deleteNotification(e){var a,t;try{return{success:!0,data:(await y.delete(`/api/notifications/${e}`)).data}}catch(r){return console.error("Error deleting notification:",r),{success:!1,error:(null==(t=null==(a=r.response)?void 0:a.data)?void 0:t.error)||"Erro ao excluir notificação"}}},async getUnreadCount(){var e,a,t;try{return{success:!0,data:{count:(null==(e=(await y.get("/api/notifications",{params:{is_read:!1,limit:1}})).data)?void 0:e.unread_count)||0}}}catch(r){return console.error("Error fetching unread count:",r),{success:!1,error:(null==(t=null==(a=r.response)?void 0:a.data)?void 0:t.error)||"Erro ao carregar contador"}}}},D={class:"min-h-screen bg-page py-8"},F={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"},_={class:"mb-8"},M={class:"flex items-center justify-between"},C={class:"bg-[#161821] rounded-lg shadow border border-[rgba(212,175,55,0.24)] p-6 mb-6"},j={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},E={key:0,class:"mt-4"},B={key:0,class:"text-center py-12"},V={key:1,class:"bg-[#161821] rounded-lg shadow border border-[rgba(212,175,55,0.24)] p-8 text-center"},N={class:"mt-2 text-sm text-body"},z={key:2,class:"bg-[#161821] rounded-lg shadow border border-[rgba(212,175,55,0.24)] p-12 text-center"},P={class:"mt-2 text-sm text-body"},L={key:3,class:"space-y-2"},H=["onClick"],T={class:"p-6"},R={class:"flex items-start"},S={class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},U=["d"],q={class:"ml-4 flex-1"},$={class:"flex items-start justify-between"},I={class:"flex-1"},K={class:"text-sm font-medium text-heading"},O={class:"mt-1 text-sm text-body"},G={key:0,class:"ml-2 w-2 h-2 bg-[#D4AF37] rounded-full flex-shrink-0"},J={class:"mt-2 flex items-center gap-4 text-xs text-gray-500"},Q={class:"flex items-center"},W={class:"ml-4 flex items-center gap-2"},X=["onClick"],Y=["onClick"],Z={key:4,class:"mt-8"},ee={__name:"Notifications",setup(y){const ee=p(),ae=e([]),te=e(!1),re=e(null),oe=e(1),se=e({type:"",status:"",sortBy:"date_desc"}),le=a(()=>ae.value.filter(e=>!e.is_read).length),ne=a(()=>""!==se.value.type||""!==se.value.status),ie=a(()=>{let e=[...ae.value];se.value.type&&(e=e.filter(e=>e.type===se.value.type)),"unread"===se.value.status?e=e.filter(e=>!e.is_read):"read"===se.value.status&&(e=e.filter(e=>e.is_read)),e.sort((e,a)=>{switch(se.value.sortBy){case"date_desc":return new Date(a.created_at)-new Date(e.created_at);case"date_asc":return new Date(e.created_at)-new Date(a.created_at);default:return 0}});const a=15*(oe.value-1),t=a+15;return e.slice(a,t)}),de=a(()=>{let e=[...ae.value];return se.value.type&&(e=e.filter(e=>e.type===se.value.type)),"unread"===se.value.status?e=e.filter(e=>!e.is_read):"read"===se.value.status&&(e=e.filter(e=>e.is_read)),Math.ceil(e.length/15)}),ce=e=>{if(!e)return"Data não disponível";try{return k(new Date(e),{addSuffix:!0,locale:A})}catch(a){return"Data inválida"}},ue=e=>({project:"Projeto",bid:"Proposta",payment:"Pagamento",message:"Mensagem",system:"Sistema"}[e]||e),me=e=>({project:"bg-[#D4AF37]/10 text-[#D4AF37] border border-[#D4AF37]/30",bid:"bg-[#22c55e]/10 text-[#22c55e] border border-[#22c55e]/30",payment:"bg-[#D4AF37]/10 text-[#D4AF37] border border-[#D4AF37]/30",message:"bg-[#D4AF37]/10 text-[#D4AF37] border border-[#D4AF37]/30",system:"bg-[#8A8A8A]/10 text-muted border border-[#8A8A8A]/30"}[e]||"bg-[#8A8A8A]/10 text-muted border border-[#8A8A8A]/30"),ve=e=>{const a={project:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",bid:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01",payment:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z",message:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z",system:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"};return a[e]||a.system},pe=()=>{se.value={type:"",status:"",sortBy:"date_desc"},oe.value=1},be=async e=>{try{if((await w.markAsRead(e)).success){const a=ae.value.find(a=>a.id===e);a&&(a.is_read=!0)}}catch(a){console.error("Error marking notification as read:",a)}},ge=async()=>{try{(await w.markAllAsRead()).success&&ae.value.forEach(e=>{e.is_read=!0})}catch(e){console.error("Error marking all notifications as read:",e)}},fe=async()=>{var e;te.value=!0,re.value=null;try{const a=await w.getNotifications({type:se.value.type,is_read:"read"===se.value.status||"unread"!==se.value.status&&void 0,limit:100});a.success?ae.value=(null==(e=a.data.data)?void 0:e.notifications)||[]:re.value=a.error}catch(a){console.error("Error loading notifications:",a),re.value="Erro ao carregar notificações"}finally{te.value=!1}};return t(()=>[se.value.type,se.value.status],()=>{oe.value=1}),r(()=>{fe()}),(e,a)=>(b(),o("div",D,[s("div",F,[s("div",_,[s("div",M,[a[4]||(a[4]=s("div",null,[s("h1",{class:"text-3xl font-bold text-heading"},"Notificações"),s("p",{class:"mt-2 text-body"},"Acompanhe todas as atualizações importantes")],-1)),le.value>0?(b(),o("button",{key:0,onClick:ge,class:"px-4 py-2 text-sm font-medium text-[#D4AF37] border border-[#D4AF37] rounded-md hover:bg-[#D4AF37]/10 transition-colors"}," Marcar todas como lida ")):l("",!0)])]),s("div",C,[s("div",j,[s("div",null,[a[6]||(a[6]=s("label",{class:"block text-sm font-medium text-body mb-2"},"Tipo",-1)),n(s("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>se.value.type=e),class:"w-full px-3 py-2 bg-[#0F1117] border border-[#333] text-heading rounded-md focus:outline-none focus:ring-[#D4AF37] focus:border-[#D4AF37]"},[...a[5]||(a[5]=[d('<option value="">Todos</option><option value="project">Projetos</option><option value="bid">Propostas</option><option value="payment">Pagamentos</option><option value="message">Mensagens</option><option value="system">Sistema</option>',6)])],512),[[i,se.value.type]])]),s("div",null,[a[8]||(a[8]=s("label",{class:"block text-sm font-medium text-body mb-2"},"Status",-1)),n(s("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>se.value.status=e),class:"w-full px-3 py-2 bg-[#0F1117] border border-[#333] text-heading rounded-md focus:outline-none focus:ring-[#D4AF37] focus:border-[#D4AF37]"},[...a[7]||(a[7]=[s("option",{value:""},"Todas",-1),s("option",{value:"unread"},"Não Lidas",-1),s("option",{value:"read"},"Lidas",-1)])],512),[[i,se.value.status]])]),s("div",null,[a[10]||(a[10]=s("label",{class:"block text-sm font-medium text-body mb-2"},"Ordenar Por",-1)),n(s("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>se.value.sortBy=e),class:"w-full px-3 py-2 bg-[#0F1117] border border-[#333] text-heading rounded-md focus:outline-none focus:ring-[#D4AF37] focus:border-[#D4AF37]"},[...a[9]||(a[9]=[s("option",{value:"date_desc"},"Mais Recentes",-1),s("option",{value:"date_asc"},"Mais Antigas",-1)])],512),[[i,se.value.sortBy]])])]),ne.value?(b(),o("div",E,[s("button",{onClick:pe,class:"text-sm text-[#D4AF37] hover:text-[#E5C04A] font-medium"}," Limpar Filtros ")])):l("",!0)]),te.value?(b(),o("div",B,[...a[11]||(a[11]=[s("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1),s("p",{class:"mt-4 text-body"},"Carregando notificações...",-1)])])):re.value?(b(),o("div",V,[a[12]||(a[12]=s("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),a[13]||(a[13]=s("h3",{class:"mt-4 text-lg font-medium text-heading"},"Erro ao carregar notificações",-1)),s("p",N,c(re.value),1),s("button",{onClick:fe,class:"mt-6 px-4 py-2 bg-[#D4AF37] text-[#0F1117] rounded-md hover:bg-[#E5C04A] font-semibold"}," Tentar Novamente ")])):0===ie.value.length?(b(),o("div",z,[a[14]||(a[14]=s("svg",{class:"mx-auto h-12 w-12 text-[#D4AF37]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)),a[15]||(a[15]=s("h3",{class:"mt-4 text-lg font-medium text-heading"},"Nenhuma notificação encontrada",-1)),s("p",P,c(ne.value?"Tente ajustar os filtros para ver mais resultados.":"Você está em dia! Não há notificações no momento."),1)])):(b(),o("div",L,[(b(!0),o(u,null,m(ie.value,e=>{return b(),o("div",{key:e.id,onClick:a=>(e=>{e.is_read||be(e.id),e.link&&ee.push(e.link)})(e),class:g(["bg-[#161821] rounded-lg shadow border border-[rgba(212,175,55,0.24)] hover:shadow-md hover:border-[#D4AF37]/50 transition-all cursor-pointer",e.is_read?"opacity-75":"border-l-4 border-l-[#D4AF37]"])},[s("div",T,[s("div",R,[s("div",{class:g([(t=e.type,{project:"bg-[#D4AF37]/10 text-[#D4AF37]",bid:"bg-[#22c55e]/10 text-[#22c55e]",payment:"bg-[#D4AF37]/10 text-[#D4AF37]",message:"bg-[#D4AF37]/10 text-[#D4AF37]",system:"bg-[#8A8A8A]/10 text-muted"}[t]||"bg-[#8A8A8A]/10 text-muted"),"flex-shrink-0 p-3 rounded-full"])},[(b(),o("svg",S,[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:ve(e.type)},null,8,U)]))],2),s("div",q,[s("div",$,[s("div",I,[s("p",K,c(e.title),1),s("p",O,c(e.message),1)]),e.is_read?l("",!0):(b(),o("span",G))]),s("div",J,[s("span",Q,[a[16]||(a[16]=s("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),f(" "+c(ce(e.created_at)),1)]),s("span",{class:g([me(e.type),"px-2 py-1 rounded-full"])},c(ue(e.type)),3)])]),s("div",W,[e.is_read?l("",!0):(b(),o("button",{key:0,onClick:h(a=>be(e.id),["stop"]),class:"p-2 text-gray-400 hover:text-body",title:"Marcar como lida"},[...a[17]||(a[17]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,X)),s("button",{onClick:h(a=>(async e=>{if(confirm("Tem certeza que deseja excluir esta notificação?"))try{if((await w.deleteNotification(e)).success){const a=ae.value.findIndex(a=>a.id===e);-1!==a&&ae.value.splice(a,1)}}catch(a){console.error("Error deleting notification:",a)}})(e.id),["stop"]),class:"p-2 text-gray-400 hover:text-red-600",title:"Excluir"},[...a[18]||(a[18]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Y)])])])],10,H);var t}),128))])),de.value>1?(b(),o("div",Z,[v(x,{"current-page":oe.value,"total-pages":de.value,onPageChanged:a[3]||(a[3]=e=>oe.value=e)},null,8,["current-page","total-pages"])])):l("",!0)])]))}};export{ee as default};
