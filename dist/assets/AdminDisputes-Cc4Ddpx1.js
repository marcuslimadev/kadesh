import{r as e,o as t,a,e as s,j as l,h as r,i as o,g as d,n as i,t as n,C as c,K as u,F as m,l as x,p as g,D as p,u as v,b as y}from"./vue-NU_yXd1p.js";import{a as b}from"./utils-CeLII1lI.js";const f={class:"min-h-screen bg-gray-100"},h={class:"bg-white shadow-lg border-b border-gray-200"},k={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},w={class:"flex justify-between h-16"},_={class:"flex items-center"},S={class:"hidden md:ml-10 md:flex md:space-x-4"},C={class:"flex items-center"},j={class:"text-sm text-gray-600 mr-4"},A={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},I={class:"mb-6 flex items-center justify-between"},D={class:"flex items-center space-x-3"},$={class:"bg-white rounded-xl shadow-md overflow-hidden"},z={key:0,class:"text-center py-12"},P={key:1},B={class:"min-w-full divide-y divide-gray-200"},E={class:"bg-white divide-y divide-gray-200"},R={class:"px-6 py-4"},T={class:"font-medium text-gray-900"},U={class:"text-xs text-gray-500"},F={class:"px-6 py-4 text-sm text-gray-700"},N={class:"px-6 py-4 text-sm text-gray-700"},V={class:"px-6 py-4 text-sm font-semibold text-gray-900"},K={class:"px-6 py-4 text-sm text-gray-600"},L={class:"px-6 py-4"},M={class:"px-6 py-4 text-sm"},q=["onClick"],J={key:0,class:"text-center py-12 text-gray-500"},O={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30"},G={class:"bg-white rounded-xl shadow-xl w-full max-w-3xl p-6"},H={class:"flex items-start justify-between mb-4"},Q={class:"text-sm text-gray-600"},W={key:0,class:"text-center py-8"},X={key:1},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Z={class:"bg-gray-50 rounded-lg p-4"},ee={class:"font-medium text-gray-900"},te={class:"text-xs text-gray-500"},ae={class:"bg-gray-50 rounded-lg p-4"},se={class:"font-medium text-gray-900"},le={class:"text-xs text-gray-500"},re={class:"mb-4"},oe={class:"space-y-2 max-h-60 overflow-auto"},de={class:"text-xs text-gray-500"},ie={class:"text-sm text-gray-800 whitespace-pre-wrap"},ne={class:"mb-2"},ce={class:"flex items-center justify-end space-x-3 pt-2"},ue=["disabled"],me=["disabled"],xe=["disabled"],ge={__name:"AdminDisputes",setup(ge){const pe=v(),ve=e(!0),ye=e([]),be=e({status:""}),fe=e(null),he=e(!1),ke=e(!1),we=e(null),_e=e(""),Se=e(!1),Ce=e=>new Date(e).toLocaleString("pt-BR"),je=async()=>{var e;try{ve.value=!0;const e=localStorage.getItem("kadesh_token")||localStorage.getItem("kadesh_token")||localStorage.getItem("adminToken"),t={};be.value.status&&(t.status=be.value.status);const{data:a}=await b.get("/api/admin/disputes",{headers:{Authorization:`Bearer ${e}`},params:t});a.success&&(ye.value=a.data)}catch(t){console.error("Error fetching disputes:",t),401===(null==(e=t.response)?void 0:e.status)&&pe.push("/admin/login")}finally{ve.value=!1}},Ae=()=>{he.value=!1,we.value=null},Ie=async e=>{var t,a;if(null==(a=null==(t=we.value)?void 0:t.contract)?void 0:a.id)try{Se.value=!0;const t=localStorage.getItem("kadesh_token")||localStorage.getItem("kadesh_token")||localStorage.getItem("adminToken");await b.post(`/api/admin/disputes/${we.value.contract.id}/resolve`,{action:e,notes:_e.value},{headers:{Authorization:`Bearer ${t}`}}),Ae(),je()}catch(s){console.error("Error resolving dispute:",s)}finally{Se.value=!1}},De=()=>{localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser"),pe.push("/admin/login")};return t(()=>{const e=localStorage.getItem("adminUser");e&&(fe.value=JSON.parse(e)),je()}),(e,t)=>{var v,ge,pe,$e,ze,Pe,Be,Ee,Re,Te,Ue,Fe,Ne,Ve;const Ke=d("router-link");return y(),a("div",f,[s("nav",h,[s("div",k,[s("div",w,[s("div",_,[t[12]||(t[12]=s("h1",{class:"text-2xl font-bold text-amber-600"},"Kaddesh Admin",-1)),s("div",S,[r(Ke,{to:"/admin/dashboard",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...t[5]||(t[5]=[g("Dashboard",-1)])]),_:1}),r(Ke,{to:"/admin/users",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...t[6]||(t[6]=[g("Usuários",-1)])]),_:1}),r(Ke,{to:"/admin/projects",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...t[7]||(t[7]=[g("Projetos",-1)])]),_:1}),r(Ke,{to:"/admin/payments",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...t[8]||(t[8]=[g("Pagamentos",-1)])]),_:1}),r(Ke,{to:"/admin/disputes",class:i(["px-3 py-2 rounded-md text-sm font-medium text-gray-900 bg-gray-100",{"bg-gray-100":"/admin/disputes"===e.$route.path}])},{default:o(()=>[...t[9]||(t[9]=[g("Disputas",-1)])]),_:1},8,["class"]),r(Ke,{to:"/admin/advertisements",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...t[10]||(t[10]=[g("Anúncios",-1)])]),_:1}),r(Ke,{to:"/admin/settings",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...t[11]||(t[11]=[g("Configurações",-1)])]),_:1})])]),s("div",C,[s("span",j,n(null==(v=fe.value)?void 0:v.name),1),s("button",{onClick:De,class:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium"},"Sair")])])])]),s("div",A,[s("div",I,[t[14]||(t[14]=s("div",null,[s("h2",{class:"text-3xl font-bold text-gray-900"},"Disputas"),s("p",{class:"mt-2 text-gray-600"},"Acompanhe e resolva disputas de contratos")],-1)),s("div",D,[c(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>be.value.status=e),onChange:je,class:"px-3 py-2 border border-gray-300 rounded-lg text-sm"},[...t[13]||(t[13]=[s("option",{value:""},"Todas",-1),s("option",{value:"open"},"Abertas",-1),s("option",{value:"closed"},"Encerradas",-1)])],544),[[u,be.value.status]]),s("button",{onClick:je,class:"px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm hover:bg-gray-50"},"Atualizar")])]),s("div",$,[ve.value?(y(),a("div",z,[...t[15]||(t[15]=[s("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"},null,-1)])])):(y(),a("div",P,[s("table",B,[t[16]||(t[16]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Projeto"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Contratante"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Prestador"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Valor"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Atualização"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Status"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Ações")])],-1)),s("tbody",E,[(y(!0),a(m,null,x(ye.value,e=>{return y(),a("tr",{key:e.contract_id,class:"hover:bg-gray-50"},[s("td",R,[s("div",T,n(e.project_title),1),s("div",U,"Contrato #"+n(e.contract_id),1)]),s("td",F,n(e.client_name),1),s("td",N,n(e.provider_name),1),s("td",V,"R$ "+n((t=e.amount,new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0))),1),s("td",K,n(Ce(e.last_activity)),1),s("td",L,[s("span",{class:i(["px-2 py-1 text-xs font-medium rounded-full",e.is_closed?"bg-gray-100 text-gray-800":"bg-yellow-100 text-yellow-800"])},n(e.is_closed?"Encerrada":"Aberta"),3)]),s("td",M,[s("button",{onClick:t=>(async e=>{try{he.value=!0,ke.value=!0,_e.value="";const t=localStorage.getItem("kadesh_token")||localStorage.getItem("kadesh_token")||localStorage.getItem("adminToken"),{data:a}=await b.get(`/api/admin/disputes/${e}`,{headers:{Authorization:`Bearer ${t}`}});a.success&&(we.value=a.data)}catch(t){console.error("Error fetching dispute detail:",t)}finally{ke.value=!1}})(e.contract_id),class:"text-amber-600 hover:text-neutral-800"},"Ver/Resolver",8,q)])]);var t}),128))])]),0===ye.value.length?(y(),a("div",J,"Nenhuma disputa encontrada.")):l("",!0)]))])]),he.value?(y(),a("div",O,[s("div",G,[s("div",H,[s("div",null,[t[17]||(t[17]=s("h3",{class:"text-xl font-bold text-gray-900"},"Detalhes da Disputa",-1)),s("p",Q,"Contrato #"+n(null==(pe=null==(ge=we.value)?void 0:ge.contract)?void 0:pe.id)+" — "+n(null==(ze=null==($e=we.value)?void 0:$e.contract)?void 0:ze.project_title),1)]),s("button",{onClick:Ae,class:"text-gray-500 hover:text-gray-700"},"✕")]),ke.value?(y(),a("div",W,[...t[18]||(t[18]=[s("div",{class:"inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-amber-600"},null,-1)])])):(y(),a("div",X,[s("div",Y,[s("div",Z,[t[19]||(t[19]=s("div",{class:"text-xs text-gray-500 mb-1"},"Contratante",-1)),s("div",ee,[g(n(null==(Be=null==(Pe=we.value)?void 0:Pe.contract)?void 0:Be.client_name)+" ",1),s("span",te,"("+n(null==(Re=null==(Ee=we.value)?void 0:Ee.contract)?void 0:Re.client_email)+")",1)])]),s("div",ae,[t[20]||(t[20]=s("div",{class:"text-xs text-gray-500 mb-1"},"Prestador",-1)),s("div",se,[g(n(null==(Ue=null==(Te=we.value)?void 0:Te.contract)?void 0:Ue.provider_name)+" ",1),s("span",le,"("+n(null==(Ne=null==(Fe=we.value)?void 0:Fe.contract)?void 0:Ne.provider_email)+")",1)])])]),s("div",re,[t[21]||(t[21]=s("div",{class:"text-sm font-semibold text-gray-800 mb-2"},"Mensagens de Disputa",-1)),s("div",oe,[(y(!0),a(m,null,x((null==(Ve=we.value)?void 0:Ve.disputeMessages)||[],e=>(y(),a("div",{key:e.id,class:"p-3 bg-gray-50 rounded border border-gray-100"},[s("div",de,n(Ce(e.created_at)),1),s("div",ie,n(e.content),1)]))),128))])]),s("div",ne,[t[22]||(t[22]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Notas (opcional)",-1)),c(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>_e.value=e),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500"},null,512),[[p,_e.value]])]),s("div",ce,[s("button",{onClick:t[2]||(t[2]=e=>Ie("dismiss")),disabled:Se.value,class:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50"},"Arquivar",8,ue),s("button",{onClick:t[3]||(t[3]=e=>Ie("refund")),disabled:Se.value,class:"px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 disabled:opacity-50"},"Reembolsar",8,me),s("button",{onClick:t[4]||(t[4]=e=>Ie("release")),disabled:Se.value,class:"px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 disabled:opacity-50"},"Liberar Pagamento",8,xe)])]))])])):l("",!0)])}}};export{ge as default};
