import{r as e,o as t,a,e as s,j as l,h as d,i as o,g as r,n,t as i,B as u,K as c,F as m,k as x,m as p,C as v,u as g,b}from"./vue-n9kv2shB.js";import{a as y}from"./utils-CeLII1lI.js";const f={class:"min-h-screen bg-page"},h={class:"bg-surface shadow-lg border-b border-theme"},k={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},_={class:"flex justify-between h-16"},w={class:"flex items-center"},S={class:"hidden md:ml-10 md:flex md:space-x-4"},C={class:"flex items-center"},j={class:"text-sm text-gray-600 mr-4"},A={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},I={class:"mb-6 flex items-center justify-between"},D={class:"flex items-center space-x-3"},$={class:"bg-surface rounded-xl shadow-md overflow-hidden"},z={key:0,class:"text-center py-12"},B={key:1},P={class:"min-w-full divide-y divide-muted"},E={class:"bg-surface divide-y divide-muted"},R={class:"px-6 py-4"},T={class:"font-medium text-heading"},U={class:"text-xs text-muted"},F={class:"px-6 py-4 text-sm text-body"},N={class:"px-6 py-4 text-sm text-body"},V={class:"px-6 py-4 text-sm font-semibold text-heading"},K={class:"px-6 py-4 text-sm text-body"},L={class:"px-6 py-4"},M={class:"px-6 py-4 text-sm"},q=["onClick"],J={key:0,class:"text-center py-12 text-gray-500"},O={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30"},G={class:"bg-surface rounded-xl shadow-xl w-full max-w-3xl p-6"},H={class:"flex items-start justify-between mb-4"},Q={class:"text-sm text-body"},W={key:0,class:"text-center py-8"},X={key:1},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Z={class:"bg-gray-50 rounded-lg p-4"},ee={class:"font-medium text-gray-900"},te={class:"text-xs text-gray-500"},ae={class:"bg-gray-50 rounded-lg p-4"},se={class:"font-medium text-gray-900"},le={class:"text-xs text-gray-500"},de={class:"mb-4"},oe={class:"space-y-2 max-h-60 overflow-auto"},re={class:"text-xs text-gray-500"},ne={class:"text-sm text-gray-800 whitespace-pre-wrap"},ie={class:"mb-2"},ue={class:"flex items-center justify-end space-x-3 pt-2"},ce=["disabled"],me=["disabled"],xe=["disabled"],pe={__name:"AdminDisputes",setup(pe){const ve=g(),ge=e(!0),be=e([]),ye=e({status:""}),fe=e(null),he=e(!1),ke=e(!1),_e=e(null),we=e(""),Se=e(!1),Ce=e=>new Date(e).toLocaleString("pt-BR"),je=async()=>{var e;try{ge.value=!0;const e=localStorage.getItem("kadesh_token")||localStorage.getItem("kadesh_token")||localStorage.getItem("adminToken"),t={};ye.value.status&&(t.status=ye.value.status);const{data:a}=await y.get("/api/admin/disputes",{headers:{Authorization:`Bearer ${e}`},params:t});a.success&&(be.value=a.data)}catch(t){console.error("Error fetching disputes:",t),401===(null==(e=t.response)?void 0:e.status)&&ve.push("/admin/login")}finally{ge.value=!1}},Ae=()=>{he.value=!1,_e.value=null},Ie=async e=>{var t,a;if(null==(a=null==(t=_e.value)?void 0:t.contract)?void 0:a.id)try{Se.value=!0;const t=localStorage.getItem("kadesh_token")||localStorage.getItem("kadesh_token")||localStorage.getItem("adminToken");await y.post(`/api/admin/disputes/${_e.value.contract.id}/resolve`,{action:e,notes:we.value},{headers:{Authorization:`Bearer ${t}`}}),Ae(),je()}catch(s){console.error("Error resolving dispute:",s)}finally{Se.value=!1}},De=()=>{localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser"),ve.push("/admin/login")};return t(()=>{const e=localStorage.getItem("adminUser");e&&(fe.value=JSON.parse(e)),je()}),(e,t)=>{var g,pe,ve,$e,ze,Be,Pe,Ee,Re,Te,Ue,Fe,Ne,Ve;const Ke=r("router-link");return b(),a("div",f,[s("nav",h,[s("div",k,[s("div",_,[s("div",w,[t[12]||(t[12]=s("h1",{class:"text-2xl font-bold text-amber-600"},"Kaddesh Admin",-1)),s("div",S,[d(Ke,{to:"/admin/dashboard",class:"px-3 py-2 rounded-md text-sm font-medium text-body hover:bg-surface-elevated"},{default:o(()=>[...t[5]||(t[5]=[p("Dashboard",-1)])]),_:1}),d(Ke,{to:"/admin/users",class:"px-3 py-2 rounded-md text-sm font-medium text-body hover:bg-surface-elevated"},{default:o(()=>[...t[6]||(t[6]=[p("Usuários",-1)])]),_:1}),d(Ke,{to:"/admin/projects",class:"px-3 py-2 rounded-md text-sm font-medium text-body hover:bg-surface-elevated"},{default:o(()=>[...t[7]||(t[7]=[p("Projetos",-1)])]),_:1}),d(Ke,{to:"/admin/payments",class:"px-3 py-2 rounded-md text-sm font-medium text-body hover:bg-surface-elevated"},{default:o(()=>[...t[8]||(t[8]=[p("Pagamentos",-1)])]),_:1}),d(Ke,{to:"/admin/disputes",class:n(["px-3 py-2 rounded-md text-sm font-medium text-heading bg-surface-elevated",{"bg-surface-elevated":"/admin/disputes"===e.$route.path}])},{default:o(()=>[...t[9]||(t[9]=[p("Disputas",-1)])]),_:1},8,["class"]),d(Ke,{to:"/admin/advertisements",class:"px-3 py-2 rounded-md text-sm font-medium text-body hover:bg-surface-elevated"},{default:o(()=>[...t[10]||(t[10]=[p("Anúncios",-1)])]),_:1}),d(Ke,{to:"/admin/settings",class:"px-3 py-2 rounded-md text-sm font-medium text-body hover:bg-surface-elevated"},{default:o(()=>[...t[11]||(t[11]=[p("Configurações",-1)])]),_:1})])]),s("div",C,[s("span",j,i(null==(g=fe.value)?void 0:g.name),1),s("button",{onClick:De,class:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium"},"Sair")])])])]),s("div",A,[s("div",I,[t[14]||(t[14]=s("div",null,[s("h2",{class:"text-3xl font-bold text-heading"},"Disputas"),s("p",{class:"mt-2 text-body"},"Acompanhe e resolva disputas de contratos")],-1)),s("div",D,[u(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>ye.value.status=e),onChange:je,class:"px-3 py-2 border border-muted rounded-lg text-sm bg-surface text-body"},[...t[13]||(t[13]=[s("option",{value:""},"Todas",-1),s("option",{value:"open"},"Abertas",-1),s("option",{value:"closed"},"Encerradas",-1)])],544),[[c,ye.value.status]]),s("button",{onClick:je,class:"px-4 py-2 bg-surface border border-muted rounded-lg text-sm hover:bg-surface-elevated text-body"},"Atualizar")])]),s("div",$,[ge.value?(b(),a("div",z,[...t[15]||(t[15]=[s("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"},null,-1)])])):(b(),a("div",B,[s("table",P,[t[16]||(t[16]=s("thead",{class:"bg-surface-alt"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted uppercase"},"Projeto"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted uppercase"},"Contratante"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted uppercase"},"Prestador"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted uppercase"},"Valor"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted uppercase"},"Atualização"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted uppercase"},"Status"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-muted uppercase"},"Ações")])],-1)),s("tbody",E,[(b(!0),a(m,null,x(be.value,e=>{return b(),a("tr",{key:e.contract_id,class:"hover:bg-surface-elevated"},[s("td",R,[s("div",T,i(e.project_title),1),s("div",U,"Contrato #"+i(e.contract_id),1)]),s("td",F,i(e.client_name),1),s("td",N,i(e.provider_name),1),s("td",V,"R$ "+i((t=e.amount,new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0))),1),s("td",K,i(Ce(e.last_activity)),1),s("td",L,[s("span",{class:n(["px-2 py-1 text-xs font-medium rounded-full",e.is_closed?"bg-gray-100 text-gray-800":"bg-yellow-100 text-yellow-800"])},i(e.is_closed?"Encerrada":"Aberta"),3)]),s("td",M,[s("button",{onClick:t=>(async e=>{try{he.value=!0,ke.value=!0,we.value="";const t=localStorage.getItem("kadesh_token")||localStorage.getItem("kadesh_token")||localStorage.getItem("adminToken"),{data:a}=await y.get(`/api/admin/disputes/${e}`,{headers:{Authorization:`Bearer ${t}`}});a.success&&(_e.value=a.data)}catch(t){console.error("Error fetching dispute detail:",t)}finally{ke.value=!1}})(e.contract_id),class:"text-amber-600 hover:text-neutral-800"},"Ver/Resolver",8,q)])]);var t}),128))])]),0===be.value.length?(b(),a("div",J,"Nenhuma disputa encontrada.")):l("",!0)]))])]),he.value?(b(),a("div",O,[s("div",G,[s("div",H,[s("div",null,[t[17]||(t[17]=s("h3",{class:"text-xl font-bold text-heading"},"Detalhes da Disputa",-1)),s("p",Q,"Contrato #"+i(null==(ve=null==(pe=_e.value)?void 0:pe.contract)?void 0:ve.id)+" — "+i(null==(ze=null==($e=_e.value)?void 0:$e.contract)?void 0:ze.project_title),1)]),s("button",{onClick:Ae,class:"text-muted hover:text-heading"},"✕")]),ke.value?(b(),a("div",W,[...t[18]||(t[18]=[s("div",{class:"inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-amber-600"},null,-1)])])):(b(),a("div",X,[s("div",Y,[s("div",Z,[t[19]||(t[19]=s("div",{class:"text-xs text-gray-500 mb-1"},"Contratante",-1)),s("div",ee,[p(i(null==(Pe=null==(Be=_e.value)?void 0:Be.contract)?void 0:Pe.client_name)+" ",1),s("span",te,"("+i(null==(Re=null==(Ee=_e.value)?void 0:Ee.contract)?void 0:Re.client_email)+")",1)])]),s("div",ae,[t[20]||(t[20]=s("div",{class:"text-xs text-gray-500 mb-1"},"Prestador",-1)),s("div",se,[p(i(null==(Ue=null==(Te=_e.value)?void 0:Te.contract)?void 0:Ue.provider_name)+" ",1),s("span",le,"("+i(null==(Ne=null==(Fe=_e.value)?void 0:Fe.contract)?void 0:Ne.provider_email)+")",1)])])]),s("div",de,[t[21]||(t[21]=s("div",{class:"text-sm font-semibold text-gray-800 mb-2"},"Mensagens de Disputa",-1)),s("div",oe,[(b(!0),a(m,null,x((null==(Ve=_e.value)?void 0:Ve.disputeMessages)||[],e=>(b(),a("div",{key:e.id,class:"p-3 bg-gray-50 rounded border border-gray-100"},[s("div",re,i(Ce(e.created_at)),1),s("div",ne,i(e.content),1)]))),128))])]),s("div",ie,[t[22]||(t[22]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Notas (opcional)",-1)),u(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>we.value=e),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500"},null,512),[[v,we.value]])]),s("div",ue,[s("button",{onClick:t[2]||(t[2]=e=>Ie("dismiss")),disabled:Se.value,class:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50"},"Arquivar",8,ce),s("button",{onClick:t[3]||(t[3]=e=>Ie("refund")),disabled:Se.value,class:"px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 disabled:opacity-50"},"Reembolsar",8,me),s("button",{onClick:t[4]||(t[4]=e=>Ie("release")),disabled:Se.value,class:"px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 disabled:opacity-50"},"Liberar Pagamento",8,xe)])]))])])):l("",!0)])}}};export{pe as default};
