import{r as e,B as a,c as l,m as s,b as t,h as n,i,a as o,j as d,k as r,e as u,n as c,t as m,F as v,l as p,C as g,p as b,M as y,D as h,K as f,T as k,R as w,o as x,u as C}from"./vue-NU_yXd1p.js";import{_ as S,a as T}from"./index-FOjKMSjo.js";import{A as q}from"./AdminLayout-xH_6EQOs.js";import"./utils-CeLII1lI.js";const A={class:"modal-container"},U={class:"modal-header"},E={key:0,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},M={key:1,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},z={key:2,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},V={key:3,class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_={class:"modal-title"},j={class:"modal-body"},$={class:"modal-message"},B={key:0,class:"modal-fields"},P=["for"],L={key:0,class:"text-red-500"},I=["id","onUpdate:modelValue","type","placeholder","required"],D=["id","onUpdate:modelValue","placeholder","required"],N=["id","onUpdate:modelValue","required"],F={value:""},R=["value"],G={key:3,class:"field-hint"},H={key:1,class:"modal-warning"},K={class:"modal-footer"},O=["disabled"],J=["disabled"],Q={key:0,class:"spinner"},W={key:1},X=S({__name:"ConfirmationModal",props:{show:{type:Boolean,default:!1},type:{type:String,default:"info",validator:e=>["info","warning","danger","success"].includes(e)},title:{type:String,required:!0},message:{type:String,required:!0},warningMessage:{type:String,default:""},confirmText:{type:String,default:"Confirmar"},cancelText:{type:String,default:"Cancelar"},fields:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["confirm","cancel","update:show"],setup(x,{emit:C}){const S=x,T=C,q=e({});a(()=>S.fields,e=>{const a={};e.forEach(e=>{a[e.name]=e.default||""}),q.value=a},{immediate:!0});const X=l(()=>!S.fields||0===S.fields.length||S.fields.every(e=>{if(!e.required)return!0;const a=q.value[e.name];return a&&""!==a.toString().trim()})),Y=()=>{X.value&&!S.loading&&T("confirm",q.value)},Z=()=>{S.loading||(q.value={},T("cancel"),T("update:show",!1))},ee=e=>{"Escape"===e.key&&S.show&&!S.loading&&Z()};return a(()=>S.show,e=>{e?document.addEventListener("keydown",ee):document.removeEventListener("keydown",ee)}),(e,a)=>(t(),s(w,{to:"body"},[n(k,{name:"modal"},{default:i(()=>[x.show?(t(),o("div",{key:0,class:"modal-backdrop",onClick:r(Z,["self"])},[u("div",A,[u("div",U,[u("div",{class:c(["modal-icon",`modal-icon-${x.type}`])},["warning"===x.type?(t(),o("svg",E,[...a[0]||(a[0]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1)])])):"danger"===x.type?(t(),o("svg",M,[...a[1]||(a[1]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):"info"===x.type?(t(),o("svg",z,[...a[2]||(a[2]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(t(),o("svg",V,[...a[3]||(a[3]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])]))],2),u("h3",_,m(x.title),1)]),u("div",j,[u("p",$,m(x.message),1),x.fields&&x.fields.length>0?(t(),o("div",B,[(t(!0),o(v,null,p(x.fields,e=>(t(),o("div",{key:e.name,class:"field-group"},[u("label",{for:e.name,class:"field-label"},[b(m(e.label)+" ",1),e.required?(t(),o("span",L,"*")):d("",!0)],8,P),"textarea"!==e.type&&"select"!==e.type?g((t(),o("input",{key:0,id:e.name,"onUpdate:modelValue":a=>q.value[e.name]=a,type:e.type||"text",placeholder:e.placeholder,required:e.required,class:"field-input"},null,8,I)),[[y,q.value[e.name]]]):"textarea"===e.type?g((t(),o("textarea",{key:1,id:e.name,"onUpdate:modelValue":a=>q.value[e.name]=a,placeholder:e.placeholder,required:e.required,rows:"3",class:"field-input"},null,8,D)),[[h,q.value[e.name]]]):"select"===e.type?g((t(),o("select",{key:2,id:e.name,"onUpdate:modelValue":a=>q.value[e.name]=a,required:e.required,class:"field-input"},[u("option",F,m(e.placeholder||"Selecione..."),1),(t(!0),o(v,null,p(e.options,e=>(t(),o("option",{key:e.value,value:e.value},m(e.label),9,R))),128))],8,N)),[[f,q.value[e.name]]]):d("",!0),e.hint?(t(),o("p",G,m(e.hint),1)):d("",!0)]))),128))])):d("",!0),x.warningMessage?(t(),o("div",H,[a[4]||(a[4]=u("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[u("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),u("span",null,m(x.warningMessage),1)])):d("",!0)]),u("div",K,[u("button",{type:"button",onClick:Z,class:"btn-secondary",disabled:x.loading},m(x.cancelText),9,O),u("button",{type:"button",onClick:Y,class:c(["btn-primary",`btn-${x.type}`]),disabled:x.loading||!X.value},[x.loading?(t(),o("span",Q)):(t(),o("span",W,m(x.confirmText),1))],10,J)])])])):d("",!0)]),_:1})]))}},[["__scopeId","data-v-fd82fd4e"]]),Y={key:0,class:"admin-alert admin-alert-success mb-6"},Z={key:1,class:"admin-alert admin-alert-danger mb-6"},ee={class:"admin-card mb-6"},ae={class:"admin-card-body"},le={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},se={class:"admin-form-group"},te={class:"admin-form-group"},ne={class:"admin-form-group"},ie={class:"admin-card"},oe={key:0,class:"text-center py-12"},de={key:1,class:"admin-table-container"},re={class:"admin-table"},ue={class:"admin-table-body"},ce={class:"admin-table-td"},me={class:"font-medium admin-text-primary"},ve={class:"admin-text-xs admin-text-secondary"},pe={class:"admin-table-td"},ge={class:"admin-table-td"},be={class:"admin-table-td admin-text-secondary"},ye={class:"admin-table-td admin-text-secondary"},he={class:"admin-table-td"},fe={class:"flex gap-2"},ke=["onClick"],we=["onClick"],xe=["onClick","title"],Ce=["onClick"],Se={key:0,class:"text-center py-12"},Te={key:1,class:"bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-200"},qe={class:"admin-text-sm admin-text-secondary"},Ae={class:"flex gap-2"},Ue=["disabled"],Ee=["disabled"],Me=S({__name:"AdminUsers",setup(a){const l=C(),r=e(!0),b=e([]),y=e({search:"",type:"",status:""}),k=e({page:1,limit:20,total:0,pages:0}),w=e(""),S=e(""),A=e(!1),U=e(null),E=e(!1),M=e([{name:"username",label:"Nome de usuário (admin)",type:"text",placeholder:"Digite o username do admin",required:!0},{name:"password",label:"Senha",type:"password",placeholder:"Digite a senha",required:!0},{name:"role",label:"Nível de Acesso",type:"select",required:!0,options:[{value:"admin",label:"Administrador"},{value:"super_admin",label:"Super Admin"}]}]),z=()=>{const e=localStorage.getItem("adminToken")||localStorage.getItem("kadesh_token");return e?{Authorization:`Bearer ${e}`}:{}},V=e(!1),_=e(!1),j=e(!1),$=e(!1),B=async()=>{var e;try{r.value=!0;const e={page:k.value.page,limit:k.value.limit,...y.value},a=await T.get("/api/admin/users",{headers:z(),params:e});a.data.success&&(b.value=a.data.data,k.value=a.data.pagination)}catch(a){console.error("Error fetching users:",a),401===(null==(e=a.response)?void 0:e.status)?l.push("/admin/login"):S.value="Erro ao carregar usuários"}finally{r.value=!1}},P=()=>{y.value={search:"",type:"",status:""},k.value.page=1,B()},L=e=>{k.value.page=e,B()},I=e=>({active:"Ativo",inactive:"Inativo",suspended:"Suspenso",pending:"Pendente"}[e]||e),D=()=>{A.value=!1,U.value=null},N=async e=>{var a,l;try{E.value=!0;(await T.post(`/api/admin/users/${U.value.id}/promote`,e,{headers:z()})).data.success&&(w.value=`${U.value.name} foi promovido a administrador com sucesso!`,D(),B(),setTimeout(()=>{w.value=""},5e3))}catch(s){console.error("Error promoting user:",s),(null==(l=null==(a=s.response)?void 0:a.data)?void 0:l.message)?S.value=s.response.data.message:S.value="Erro ao promover usuário a administrador"}finally{E.value=!1}},F=()=>{V.value=!1,U.value=null},R=async()=>{try{_.value=!0;const e="active"===U.value.status?"suspended":"active";await T.patch(`/api/admin/users/${U.value.id}/status`,{status:e},{headers:z()}),w.value="Status atualizado com sucesso",F(),B(),setTimeout(()=>{w.value=""},3e3)}catch(e){console.error("Error updating user status:",e),S.value="Erro ao atualizar status do usuário"}finally{_.value=!1}},G=()=>{j.value=!1,U.value=null},H=async()=>{try{$.value=!0,await T.delete(`/api/admin/users/${U.value.id}`,{headers:z()}),w.value="Usuário excluído com sucesso",G(),B(),setTimeout(()=>{w.value=""},3e3)}catch(e){console.error("Error deleting user:",e),S.value="Erro ao excluir usuário"}finally{$.value=!1}};return x(()=>{B()}),(e,a)=>(t(),s(q,null,{header:i(()=>[...a[7]||(a[7]=[u("div",null,[u("h1",{class:"admin-heading-1"},"Gerenciar Usuários"),u("p",{class:"admin-text-secondary mt-2"},"Visualize e gerencie todos os usuários da plataforma")],-1)])]),default:i(()=>{var e,s,i,x,C,T,q;return[w.value?(t(),o("div",Y,[u("p",null,m(w.value),1),u("button",{onClick:a[0]||(a[0]=e=>w.value=""),class:"admin-alert-close"},"×")])):d("",!0),S.value?(t(),o("div",Z,[u("p",null,m(S.value),1),u("button",{onClick:a[1]||(a[1]=e=>S.value=""),class:"admin-alert-close"},"×")])):d("",!0),u("div",ee,[u("div",ae,[u("div",le,[u("div",se,[a[8]||(a[8]=u("label",{class:"admin-form-label"},"Buscar",-1)),g(u("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>y.value.search=e),onInput:B,type:"text",class:"admin-form-input",placeholder:"Nome ou email..."},null,544),[[h,y.value.search]])]),u("div",te,[a[10]||(a[10]=u("label",{class:"admin-form-label"},"Tipo",-1)),g(u("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>y.value.type=e),onChange:B,class:"admin-form-select"},[...a[9]||(a[9]=[u("option",{value:""},"Todos",-1),u("option",{value:"client"},"Contratantes",-1),u("option",{value:"provider"},"Prestadores",-1)])],544),[[f,y.value.type]])]),u("div",ne,[a[12]||(a[12]=u("label",{class:"admin-form-label"},"Status",-1)),g(u("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>y.value.status=e),onChange:B,class:"admin-form-select"},[...a[11]||(a[11]=[u("option",{value:""},"Todos",-1),u("option",{value:"active"},"Ativo",-1),u("option",{value:"inactive"},"Inativo",-1),u("option",{value:"suspended"},"Suspenso",-1)])],544),[[f,y.value.status]])]),u("div",{class:"flex items-end"},[u("button",{onClick:P,class:"admin-btn admin-btn-outline w-full"}," Limpar Filtros ")])])])]),u("div",ie,[r.value?(t(),o("div",oe,[...a[13]||(a[13]=[u("div",{class:"admin-spinner-lg"},null,-1),u("p",{class:"mt-4 admin-text-secondary"},"Carregando usuários...",-1)])])):(t(),o("div",de,[u("table",re,[a[14]||(a[14]=u("thead",{class:"admin-table-head"},[u("tr",null,[u("th",{class:"admin-table-th"},"Usuário"),u("th",{class:"admin-table-th"},"Tipo"),u("th",{class:"admin-table-th"},"Status"),u("th",{class:"admin-table-th"},"Localização"),u("th",{class:"admin-table-th"},"Cadastro"),u("th",{class:"admin-table-th"},"Ações")])],-1)),u("tbody",ue,[(t(!0),o(v,null,p(b.value,e=>{return t(),o("tr",{key:e.id,class:"admin-table-row"},[u("td",ce,[u("div",null,[u("div",me,m(e.name),1),u("div",ve,m(e.email),1)])]),u("td",pe,[u("span",{class:c(["admin-badge","client"===e.type?"admin-badge-primary":"admin-badge-success"])},m("client"===e.type?"Contratante":"Prestador"),3)]),u("td",ge,[u("span",{class:c(["admin-badge",(s=e.status,{active:"admin-badge-success",inactive:"admin-badge-neutral",suspended:"admin-badge-danger",pending:"admin-badge-warning"}[s]||"admin-badge-neutral")])},m(I(e.status)),3)]),u("td",be,m(e.location||"-"),1),u("td",ye,m((a=e.created_at,new Date(a).toLocaleDateString("pt-BR"))),1),u("td",he,[u("div",fe,[u("button",{onClick:a=>{return s=e.id,void l.push(`/admin/users/${s}`);var s},class:"admin-btn admin-btn-sm admin-btn-outline",title:"Ver detalhes"}," Ver ",8,ke),u("button",{onClick:a=>(e=>{U.value=e,A.value=!0})(e),class:"admin-btn admin-btn-sm admin-btn-warning",title:"Promover a administrador"}," Promover ",8,we),u("button",{onClick:a=>(e=>{U.value=e,V.value=!0})(e),class:"admin-btn admin-btn-sm admin-btn-secondary",title:"active"===e.status?"Suspender usuário":"Ativar usuário"},m("active"===e.status?"Suspender":"Ativar"),9,xe),u("button",{onClick:a=>(e=>{U.value=e,j.value=!0})(e),class:"admin-btn admin-btn-sm admin-btn-danger",title:"Excluir usuário"}," Excluir ",8,Ce)])])]);var a,s}),128))])]),0===b.value.length?(t(),o("div",Se,[...a[15]||(a[15]=[u("p",{class:"admin-text-secondary"},"Nenhum usuário encontrado",-1)])])):d("",!0),k.value.pages>1?(t(),o("div",Te,[u("div",qe," Página "+m(k.value.page)+" de "+m(k.value.pages)+" ("+m(k.value.total)+" usuários) ",1),u("div",Ae,[u("button",{onClick:a[5]||(a[5]=e=>L(k.value.page-1)),disabled:1===k.value.page,class:"admin-btn admin-btn-sm admin-btn-outline"}," Anterior ",8,Ue),u("button",{onClick:a[6]||(a[6]=e=>L(k.value.page+1)),disabled:k.value.page===k.value.pages,class:"admin-btn admin-btn-sm admin-btn-outline"}," Próxima ",8,Ee)])])):d("",!0)]))]),n(X,{show:A.value,type:"warning",title:"Promover Usuário a Administrador",message:`Você está prestes a promover ${null==(e=U.value)?void 0:e.name} a administrador. Preencha os dados de acesso administrativo:`,warningMessage:"O usuário terá acesso total ao painel administrativo.",confirmText:"Promover",cancelText:"Cancelar",fields:M.value,loading:E.value,onConfirm:N,onCancel:D},null,8,["show","message","fields","loading"]),n(X,{show:V.value,type:"active"===(null==(s=U.value)?void 0:s.status)?"warning":"info",title:"active"===(null==(i=U.value)?void 0:i.status)?"Suspender Usuário":"Ativar Usuário",message:`Tem certeza que deseja ${"active"===(null==(x=U.value)?void 0:x.status)?"suspender":"ativar"} o usuário ${null==(C=U.value)?void 0:C.name}?`,confirmText:"active"===(null==(T=U.value)?void 0:T.status)?"Suspender":"Ativar",cancelText:"Cancelar",loading:_.value,onConfirm:R,onCancel:F},null,8,["show","type","title","message","confirmText","loading"]),n(X,{show:j.value,type:"danger",title:"Excluir Usuário",message:`Tem certeza que deseja excluir o usuário ${null==(q=U.value)?void 0:q.name}?`,warningMessage:"Esta ação não pode ser desfeita. Todos os dados do usuário serão permanentemente removidos.",confirmText:"Sim, excluir",cancelText:"Cancelar",loading:$.value,onConfirm:H,onCancel:G},null,8,["show","message","loading"])]}),_:1}))}},[["__scopeId","data-v-51064bb4"]]);export{Me as default};
