import{r as e,o as a,a as t,e as s,h as l,i as o,g as r,j as n,t as d,n as i,C as u,p as c,D as x,M as m,K as v,F as p,l as g,u as b,b as y}from"./vue-NU_yXd1p.js";import{a as f}from"./index-hGz4oRih.js";import{a as h}from"./utils-CeLII1lI.js";const k={class:"min-h-screen bg-gray-100"},w={class:"bg-white shadow-lg border-b border-gray-200"},C={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},M={class:"flex justify-between h-16"},_={class:"flex items-center"},P={class:"hidden md:ml-10 md:flex md:space-x-4"},S={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},A={key:0,class:"text-center py-12"},j={key:1,class:"mb-6 bg-red-50 border-l-4 border-red-500 p-4 rounded"},z={class:"flex"},B={class:"ml-3"},L={class:"text-sm text-red-700"},E={key:2,class:"mb-6 bg-green-50 border-l-4 border-green-500 p-4 rounded"},U={class:"flex"},I={class:"ml-3"},T={class:"text-sm text-green-700"},V={key:3},D={class:"border-b border-gray-200 mb-6"},R={class:"-mb-px flex space-x-8"},q={key:0,class:"bg-white rounded-xl shadow-md p-6"},K={class:"space-y-6"},$={class:"relative"},N=["type"],F={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},H={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},O={class:"flex items-center justify-end gap-3 pt-4 border-t"},G=["disabled"],J=["disabled"],Q={key:1,class:"bg-white rounded-xl shadow-md p-6"},W={class:"mb-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},X=["disabled"],Y={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Z={class:"space-y-6"},ee={class:"flex items-start justify-between"},ae={class:"flex-1 mr-4"},te={class:"text-base font-medium text-gray-900"},se={class:"text-sm text-gray-500 mt-1"},le={class:"mt-3"},oe=["onUpdate:modelValue","onBlur"],re={__name:"AdminSettings",setup(re){const ne=b(),de=e(!0),ie=e(!1),ue=e(!1),ce=e(null),xe=e(null),me=e([]),ve=e("mercadopago"),pe=e(!1),ge=()=>{const e=localStorage.getItem("adminToken")||localStorage.getItem("kadesh_token");return e?{Authorization:`Bearer ${e}`}:{}},be=e(""),ye=e(""),fe=e("sandbox"),he=async()=>{var e,a,t;try{ce.value=null;const t=await f.get("/api/admin/settings",{headers:ge()}),s=(null==(e=t.data)?void 0:e.settings)||(null==(a=t.data)?void 0:a.data)||{};me.value=Object.entries(s).map(([e,a])=>({key:e,value:(null==a?void 0:a.value)??"",description:(null==a?void 0:a.description)??"",is_public:Boolean(null==a?void 0:a.is_public)}));const l=me.value.find(e=>"mp_public_key"===e.key),o=me.value.find(e=>"mp_access_token"===e.key),r=me.value.find(e=>"mp_environment"===e.key);l&&(be.value=l.value),o&&(ye.value=o.value),r&&(fe.value=r.value)}catch(s){console.error("Error fetching settings:",s),401===(null==(t=s.response)?void 0:t.status)?ne.push("/admin/login"):ce.value="Não foi possível carregar as configurações. Tente novamente."}finally{de.value=!1}},ke=async()=>{var e,a,t;try{ie.value=!0,ce.value=null,xe.value=null;const a=[{key:"mp_public_key",value:be.value,description:"Chave pública do Mercado Pago",is_public:!0},{key:"mp_access_token",value:ye.value,description:"Access Token do Mercado Pago",is_public:!1},{key:"mp_environment",value:fe.value,description:"Ambiente do Mercado Pago (sandbox/production)",is_public:!0}];for(const t of a)try{await f.put("/api/admin/settings",{value:t.value},{params:{key:t.key},headers:ge()})}catch(s){if(404!==(null==(e=s.response)?void 0:e.status))throw s;await f.post("/api/admin/settings",t,{headers:ge()})}xe.value="Configurações do Mercado Pago salvas com sucesso!",await he()}catch(s){console.error("Error saving MP config:",s),ce.value="Erro ao salvar configurações do Mercado Pago: "+((null==(t=null==(a=s.response)?void 0:a.data)?void 0:t.error)||s.message)}finally{ie.value=!1}},we=async()=>{var e;try{ie.value=!0,ce.value=null,xe.value=null;(await h.get("https://api.mercadopago.com/v1/payment_methods",{headers:{Authorization:`Bearer ${ye.value}`}})).data&&(xe.value="✅ Conexão com Mercado Pago testada com sucesso! Credenciais válidas.")}catch(a){console.error("Error testing MP:",a),401===(null==(e=a.response)?void 0:e.status)?ce.value="❌ Access Token inválido. Verifique suas credenciais no Mercado Pago.":ce.value="❌ Erro ao testar conexão: "+(a.message||"Verifique suas credenciais.")}finally{ie.value=!1}},Ce=async()=>{var e,a;if(confirm("Isso tentará criar tabelas ausentes no banco de dados. Continuar?"))try{ue.value=!0,ce.value=null,xe.value=null;const e=localStorage.getItem("kadesh_token")||localStorage.getItem("kadesh_token")||localStorage.getItem("adminToken"),a=await h.post("/api/admin/run-migrations",{},{headers:{Authorization:`Bearer ${e}`}});a.data.success?xe.value="✅ Migrações executadas com sucesso! "+a.data.logs.join("\n"):ce.value="⚠️ Migrações concluídas com avisos: "+a.data.logs.join("\n")}catch(t){console.error("Error running migrations:",t),ce.value="❌ Erro ao executar migrações: "+((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.error)||t.message)}finally{ue.value=!1}},Me=()=>{localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser"),ne.push("/admin/login")};return a(()=>{he()}),(e,a)=>{const b=r("router-link");return y(),t("div",k,[s("nav",w,[s("div",C,[s("div",M,[s("div",_,[a[15]||(a[15]=s("h1",{class:"text-2xl font-bold text-amber-600"},"Kadesh Admin",-1)),s("div",P,[l(b,{to:"/admin/dashboard",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...a[8]||(a[8]=[c("Dashboard",-1)])]),_:1}),l(b,{to:"/admin/users",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...a[9]||(a[9]=[c("Usuários",-1)])]),_:1}),l(b,{to:"/admin/projects",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...a[10]||(a[10]=[c("Projetos",-1)])]),_:1}),l(b,{to:"/admin/payments",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...a[11]||(a[11]=[c("Pagamentos",-1)])]),_:1}),l(b,{to:"/admin/disputes",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...a[12]||(a[12]=[c("Disputas",-1)])]),_:1}),l(b,{to:"/admin/advertisements",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:o(()=>[...a[13]||(a[13]=[c("Anúncios",-1)])]),_:1}),l(b,{to:"/admin/settings",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-900 bg-gray-100"},{default:o(()=>[...a[14]||(a[14]=[c("Configurações",-1)])]),_:1})])]),s("div",{class:"flex items-center"},[s("button",{onClick:Me,class:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium"},"Sair")])])])]),s("div",S,[a[36]||(a[36]=s("h2",{class:"text-3xl font-bold text-gray-900 mb-6"},"Configurações do Sistema",-1)),de.value?(y(),t("div",A,[...a[16]||(a[16]=[s("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"},null,-1)])])):n("",!0),ce.value?(y(),t("div",j,[s("div",z,[a[18]||(a[18]=s("div",{class:"flex-shrink-0"},[s("svg",{class:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),s("div",B,[s("p",L,d(ce.value),1)]),s("button",{onClick:a[0]||(a[0]=e=>ce.value=null),class:"ml-auto text-red-400 hover:text-red-600"},[...a[17]||(a[17]=[s("svg",{class:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])])])):n("",!0),xe.value?(y(),t("div",E,[s("div",U,[a[20]||(a[20]=s("div",{class:"flex-shrink-0"},[s("svg",{class:"h-5 w-5 text-green-400",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),s("div",I,[s("p",T,d(xe.value),1)]),s("button",{onClick:a[1]||(a[1]=e=>xe.value=null),class:"ml-auto text-green-400 hover:text-green-600"},[...a[19]||(a[19]=[s("svg",{class:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])])])):n("",!0),de.value?n("",!0):(y(),t("div",V,[s("div",D,[s("nav",R,[s("button",{onClick:a[2]||(a[2]=e=>ve.value="mercadopago"),class:i(["py-4 px-1 border-b-2 font-medium text-sm","mercadopago"===ve.value?"border-amber-500 text-amber-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Mercado Pago ",2),s("button",{onClick:a[3]||(a[3]=e=>ve.value="system"),class:i(["py-4 px-1 border-b-2 font-medium text-sm","system"===ve.value?"border-amber-500 text-amber-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Sistema ",2)])]),"mercadopago"===ve.value?(y(),t("div",q,[a[30]||(a[30]=s("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Configurações do Mercado Pago",-1)),a[31]||(a[31]=s("p",{class:"text-sm text-gray-600 mb-6"},"Configure as chaves de API do Mercado Pago para processar pagamentos.",-1)),s("div",K,[s("div",null,[a[21]||(a[21]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[c(" Public Key * "),s("span",{class:"text-xs text-gray-500 ml-2"},"(Chave pública para frontend)")],-1)),u(s("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>be.value=e),type:"text",placeholder:"APP_USR-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"},null,512),[[x,be.value]]),a[22]||(a[22]=s("p",{class:"mt-1 text-xs text-gray-500"},"Encontre em: Dashboard do Mercado Pago → Suas integrações → Credenciais",-1))]),s("div",null,[a[25]||(a[25]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[c(" Access Token * "),s("span",{class:"text-xs text-gray-500 ml-2"},"(Chave privada para backend)")],-1)),s("div",$,[u(s("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>ye.value=e),type:pe.value?"text":"password",placeholder:"APP_USR-xxxxxxxxxxxx-xxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-xxxxxxxxxx",class:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"},null,8,N),[[m,ye.value]]),s("button",{type:"button",onClick:a[6]||(a[6]=e=>pe.value=!pe.value),class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"},[pe.value?(y(),t("svg",H,[...a[24]||(a[24]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])])):(y(),t("svg",F,[...a[23]||(a[23]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])]))])]),a[26]||(a[26]=s("p",{class:"mt-1 text-xs text-gray-500"},"⚠️ Nunca compartilhe este token! Ele dá acesso total à sua conta MP.",-1))]),s("div",null,[a[28]||(a[28]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Ambiente ",-1)),u(s("select",{"onUpdate:modelValue":a[7]||(a[7]=e=>fe.value=e),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"},[...a[27]||(a[27]=[s("option",{value:"sandbox"},"Sandbox (Testes)",-1),s("option",{value:"production"},"Produção (Real)",-1)])],512),[[v,fe.value]]),a[29]||(a[29]=s("p",{class:"mt-1 text-xs text-gray-500"},"Use Sandbox para testes. Mude para Produção quando estiver pronto.",-1))]),s("div",O,[s("button",{onClick:we,disabled:ie.value||!be.value||!ye.value,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"}," Testar Conexão ",8,G),s("button",{onClick:ke,disabled:ie.value||!be.value||!ye.value,class:"px-6 py-2 text-sm font-medium text-white bg-amber-600 rounded-lg hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed"},d(ie.value?"Salvando...":"Salvar Configurações"),9,J)])])])):n("",!0),"system"===ve.value?(y(),t("div",Q,[a[35]||(a[35]=s("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Configurações do Sistema",-1)),s("div",W,[a[33]||(a[33]=s("h4",{class:"text-lg font-medium text-yellow-800 mb-2"},"⚠️ Manutenção do Banco de Dados",-1)),a[34]||(a[34]=s("p",{class:"text-sm text-yellow-700 mb-4"}," Use esta ferramenta se estiver enfrentando erros 500 ou problemas de tabelas faltando (ex: advertisements). Isso forçará a execução das migrações pendentes. ",-1)),s("button",{onClick:Ce,disabled:ue.value,class:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50 flex items-center"},[ue.value?(y(),t("svg",Y,[...a[32]||(a[32]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):n("",!0),c(" "+d(ue.value?"Executando Migrações...":"Reparar Banco de Dados (Executar Migrações)"),1)],8,X)]),s("div",Z,[(y(!0),t(p,null,g(me.value,e=>(y(),t("div",{key:e.key,class:"border-b border-gray-200 pb-6 last:border-0"},[s("div",ee,[s("div",ae,[s("h4",te,d(e.key),1),s("p",se,d(e.description),1),s("div",le,[u(s("input",{"onUpdate:modelValue":a=>e.value=a,onBlur:a=>(async e=>{var a,t;try{ce.value=null,await f.put("/api/admin/settings",{value:e.value},{params:{key:e.key},headers:ge()}),xe.value="Configuração atualizada!",setTimeout(()=>{xe.value=null},3e3)}catch(s){console.error("Error updating setting:",s),ce.value="Erro ao atualizar configuração: "+((null==(t=null==(a=s.response)?void 0:a.data)?void 0:t.error)||s.message)}})(e),type:"text",class:"w-full max-w-md px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500"},null,40,oe),[[x,e.value]])])]),s("span",{class:i(["px-2 py-1 text-xs font-medium rounded-full",e.is_public?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},d(e.is_public?"Público":"Privado"),3)])]))),128))])])):n("",!0)]))])])}}};export{re as default};
