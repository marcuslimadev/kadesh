import{r as e,o as a,a as t,e as o,h as s,j as l,g as r,i as n,t as d,n as i,B as u,p as c,C as x,L as m,J as g,F as v,l as p,u as b,b as y}from"./vue-_iW_wwAQ.js";import{a as f}from"./utils-CeLII1lI.js";const h={class:"min-h-screen bg-gray-100"},k={class:"bg-white shadow-lg border-b border-gray-200"},w={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},C={class:"flex justify-between h-16"},_={class:"flex items-center"},M={class:"hidden md:ml-10 md:flex md:space-x-4"},P={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},S={key:0,class:"text-center py-12"},A={key:1,class:"mb-6 bg-red-50 border-l-4 border-red-500 p-4 rounded"},z={class:"flex"},B={class:"ml-3"},I={class:"text-sm text-red-700"},L={key:2,class:"mb-6 bg-green-50 border-l-4 border-green-500 p-4 rounded"},j={class:"flex"},E={class:"ml-3"},T={class:"text-sm text-green-700"},U={key:3},V={class:"border-b border-gray-200 mb-6"},$={class:"-mb-px flex space-x-8"},D={key:0,class:"bg-white rounded-xl shadow-md p-6"},R={class:"space-y-6"},q={class:"relative"},K=["type"],N={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},F={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},H={class:"flex items-center justify-end gap-3 pt-4 border-t"},J=["disabled"],G=["disabled"],O={key:1,class:"bg-white rounded-xl shadow-md p-6"},Q={class:"mb-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},W=["disabled"],X={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Y={class:"space-y-6"},Z={class:"flex items-start justify-between"},ee={class:"flex-1 mr-4"},ae={class:"text-base font-medium text-gray-900"},te={class:"text-sm text-gray-500 mt-1"},oe={class:"mt-3"},se=["onUpdate:modelValue","onBlur"],le={__name:"AdminSettings",setup(le){const re=b(),ne=e(!0),de=e(!1),ie=e(!1),ue=e(null),ce=e(null),xe=e([]),me=e("mercadopago"),ge=e(!1),ve=e(""),pe=e(""),be=e("sandbox"),ye=async()=>{var e;try{ue.value=null;const e=localStorage.getItem("kadesh_token")||localStorage.getItem("kadesh_token")||localStorage.getItem("adminToken"),a=await f.get("/api/admin/settings",{headers:{Authorization:`Bearer ${e}`}});if(a.data.success){xe.value=a.data.data;const e=xe.value.find(e=>"mp_public_key"===e.key),t=xe.value.find(e=>"mp_access_token"===e.key),o=xe.value.find(e=>"mp_environment"===e.key);e&&(ve.value=e.value),t&&(pe.value=t.value),o&&(be.value=o.value)}}catch(a){console.error("Error fetching settings:",a),401===(null==(e=a.response)?void 0:e.status)?re.push("/admin/login"):ue.value="Não foi possível carregar as configurações. Tente novamente."}finally{ne.value=!1}},fe=async()=>{var e,a,t;try{de.value=!0,ue.value=null,ce.value=null;const a=localStorage.getItem("kadesh_token")||localStorage.getItem("kadesh_token")||localStorage.getItem("adminToken"),t=[{key:"mp_public_key",value:ve.value,description:"Chave pública do Mercado Pago",is_public:!0},{key:"mp_access_token",value:pe.value,description:"Access Token do Mercado Pago",is_public:!1},{key:"mp_environment",value:be.value,description:"Ambiente do Mercado Pago (sandbox/production)",is_public:!0}];for(const s of t)try{await f.put(`/api/admin/settings/${s.key}`,s,{headers:{Authorization:`Bearer ${a}`}})}catch(o){if(404!==(null==(e=o.response)?void 0:e.status))throw o;await f.post("/api/admin/settings",s,{headers:{Authorization:`Bearer ${a}`}})}ce.value="Configurações do Mercado Pago salvas com sucesso!",await ye()}catch(o){console.error("Error saving MP config:",o),ue.value="Erro ao salvar configurações do Mercado Pago: "+((null==(t=null==(a=o.response)?void 0:a.data)?void 0:t.error)||o.message)}finally{de.value=!1}},he=async()=>{var e;try{de.value=!0,ue.value=null,ce.value=null;(await f.get("https://api.mercadopago.com/v1/payment_methods",{headers:{Authorization:`Bearer ${pe.value}`}})).data&&(ce.value="✅ Conexão com Mercado Pago testada com sucesso! Credenciais válidas.")}catch(a){console.error("Error testing MP:",a),401===(null==(e=a.response)?void 0:e.status)?ue.value="❌ Access Token inválido. Verifique suas credenciais no Mercado Pago.":ue.value="❌ Erro ao testar conexão: "+(a.message||"Verifique suas credenciais.")}finally{de.value=!1}},ke=async()=>{var e,a;if(confirm("Isso tentará criar tabelas ausentes no banco de dados. Continuar?"))try{ie.value=!0,ue.value=null,ce.value=null;const e=localStorage.getItem("kadesh_token")||localStorage.getItem("kadesh_token")||localStorage.getItem("adminToken"),a=await f.post("/api/admin/run-migrations",{},{headers:{Authorization:`Bearer ${e}`}});a.data.success?ce.value="✅ Migrações executadas com sucesso! "+a.data.logs.join("\n"):ue.value="⚠️ Migrações concluídas com avisos: "+a.data.logs.join("\n")}catch(t){console.error("Error running migrations:",t),ue.value="❌ Erro ao executar migrações: "+((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.error)||t.message)}finally{ie.value=!1}},we=()=>{localStorage.removeItem("adminToken"),localStorage.removeItem("adminUser"),re.push("/admin/login")};return a(()=>{ye()}),(e,a)=>{const b=r("router-link");return y(),t("div",h,[o("nav",k,[o("div",w,[o("div",C,[o("div",_,[a[15]||(a[15]=o("h1",{class:"text-2xl font-bold text-amber-600"},"Kadesh Admin",-1)),o("div",M,[s(b,{to:"/admin/dashboard",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:l(()=>[...a[8]||(a[8]=[c("Dashboard",-1)])]),_:1}),s(b,{to:"/admin/users",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:l(()=>[...a[9]||(a[9]=[c("Usuários",-1)])]),_:1}),s(b,{to:"/admin/projects",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:l(()=>[...a[10]||(a[10]=[c("Projetos",-1)])]),_:1}),s(b,{to:"/admin/payments",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:l(()=>[...a[11]||(a[11]=[c("Pagamentos",-1)])]),_:1}),s(b,{to:"/admin/disputes",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:l(()=>[...a[12]||(a[12]=[c("Disputas",-1)])]),_:1}),s(b,{to:"/admin/advertisements",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100"},{default:l(()=>[...a[13]||(a[13]=[c("Anúncios",-1)])]),_:1}),s(b,{to:"/admin/settings",class:"px-3 py-2 rounded-md text-sm font-medium text-gray-900 bg-gray-100"},{default:l(()=>[...a[14]||(a[14]=[c("Configurações",-1)])]),_:1})])]),o("div",{class:"flex items-center"},[o("button",{onClick:we,class:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium"},"Sair")])])])]),o("div",P,[a[36]||(a[36]=o("h2",{class:"text-3xl font-bold text-gray-900 mb-6"},"Configurações do Sistema",-1)),ne.value?(y(),t("div",S,[...a[16]||(a[16]=[o("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"},null,-1)])])):n("",!0),ue.value?(y(),t("div",A,[o("div",z,[a[18]||(a[18]=o("div",{class:"flex-shrink-0"},[o("svg",{class:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),o("div",B,[o("p",I,d(ue.value),1)]),o("button",{onClick:a[0]||(a[0]=e=>ue.value=null),class:"ml-auto text-red-400 hover:text-red-600"},[...a[17]||(a[17]=[o("svg",{class:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])])])):n("",!0),ce.value?(y(),t("div",L,[o("div",j,[a[20]||(a[20]=o("div",{class:"flex-shrink-0"},[o("svg",{class:"h-5 w-5 text-green-400",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),o("div",E,[o("p",T,d(ce.value),1)]),o("button",{onClick:a[1]||(a[1]=e=>ce.value=null),class:"ml-auto text-green-400 hover:text-green-600"},[...a[19]||(a[19]=[o("svg",{class:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])])])):n("",!0),ne.value?n("",!0):(y(),t("div",U,[o("div",V,[o("nav",$,[o("button",{onClick:a[2]||(a[2]=e=>me.value="mercadopago"),class:i(["py-4 px-1 border-b-2 font-medium text-sm","mercadopago"===me.value?"border-amber-500 text-amber-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Mercado Pago ",2),o("button",{onClick:a[3]||(a[3]=e=>me.value="system"),class:i(["py-4 px-1 border-b-2 font-medium text-sm","system"===me.value?"border-amber-500 text-amber-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Sistema ",2)])]),"mercadopago"===me.value?(y(),t("div",D,[a[30]||(a[30]=o("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Configurações do Mercado Pago",-1)),a[31]||(a[31]=o("p",{class:"text-sm text-gray-600 mb-6"},"Configure as chaves de API do Mercado Pago para processar pagamentos.",-1)),o("div",R,[o("div",null,[a[21]||(a[21]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[c(" Public Key * "),o("span",{class:"text-xs text-gray-500 ml-2"},"(Chave pública para frontend)")],-1)),u(o("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>ve.value=e),type:"text",placeholder:"APP_USR-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"},null,512),[[x,ve.value]]),a[22]||(a[22]=o("p",{class:"mt-1 text-xs text-gray-500"},"Encontre em: Dashboard do Mercado Pago → Suas integrações → Credenciais",-1))]),o("div",null,[a[25]||(a[25]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[c(" Access Token * "),o("span",{class:"text-xs text-gray-500 ml-2"},"(Chave privada para backend)")],-1)),o("div",q,[u(o("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>pe.value=e),type:ge.value?"text":"password",placeholder:"APP_USR-xxxxxxxxxxxx-xxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-xxxxxxxxxx",class:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"},null,8,K),[[m,pe.value]]),o("button",{type:"button",onClick:a[6]||(a[6]=e=>ge.value=!ge.value),class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700"},[ge.value?(y(),t("svg",F,[...a[24]||(a[24]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"},null,-1)])])):(y(),t("svg",N,[...a[23]||(a[23]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])]))])]),a[26]||(a[26]=o("p",{class:"mt-1 text-xs text-gray-500"},"⚠️ Nunca compartilhe este token! Ele dá acesso total à sua conta MP.",-1))]),o("div",null,[a[28]||(a[28]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Ambiente ",-1)),u(o("select",{"onUpdate:modelValue":a[7]||(a[7]=e=>be.value=e),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"},[...a[27]||(a[27]=[o("option",{value:"sandbox"},"Sandbox (Testes)",-1),o("option",{value:"production"},"Produção (Real)",-1)])],512),[[g,be.value]]),a[29]||(a[29]=o("p",{class:"mt-1 text-xs text-gray-500"},"Use Sandbox para testes. Mude para Produção quando estiver pronto.",-1))]),o("div",H,[o("button",{onClick:he,disabled:de.value||!ve.value||!pe.value,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"}," Testar Conexão ",8,J),o("button",{onClick:fe,disabled:de.value||!ve.value||!pe.value,class:"px-6 py-2 text-sm font-medium text-white bg-amber-600 rounded-lg hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed"},d(de.value?"Salvando...":"Salvar Configurações"),9,G)])])])):n("",!0),"system"===me.value?(y(),t("div",O,[a[35]||(a[35]=o("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Configurações do Sistema",-1)),o("div",Q,[a[33]||(a[33]=o("h4",{class:"text-lg font-medium text-yellow-800 mb-2"},"⚠️ Manutenção do Banco de Dados",-1)),a[34]||(a[34]=o("p",{class:"text-sm text-yellow-700 mb-4"}," Use esta ferramenta se estiver enfrentando erros 500 ou problemas de tabelas faltando (ex: advertisements). Isso forçará a execução das migrações pendentes. ",-1)),o("button",{onClick:ke,disabled:ie.value,class:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50 flex items-center"},[ie.value?(y(),t("svg",X,[...a[32]||(a[32]=[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):n("",!0),c(" "+d(ie.value?"Executando Migrações...":"Reparar Banco de Dados (Executar Migrações)"),1)],8,W)]),o("div",Y,[(y(!0),t(v,null,p(xe.value,e=>(y(),t("div",{key:e.key,class:"border-b border-gray-200 pb-6 last:border-0"},[o("div",Z,[o("div",ee,[o("h4",ae,d(e.key),1),o("p",te,d(e.description),1),o("div",oe,[u(o("input",{"onUpdate:modelValue":a=>e.value=a,onBlur:a=>(async e=>{var a,t;try{ue.value=null;const a=localStorage.getItem("kadesh_token")||localStorage.getItem("kadesh_token")||localStorage.getItem("adminToken");await f.put(`/api/admin/settings/${e.key}`,{value:e.value},{headers:{Authorization:`Bearer ${a}`}}),ce.value="Configuração atualizada!",setTimeout(()=>{ce.value=null},3e3)}catch(o){console.error("Error updating setting:",o),ue.value="Erro ao atualizar configuração: "+((null==(t=null==(a=o.response)?void 0:a.data)?void 0:t.error)||o.message)}})(e),type:"text",class:"w-full max-w-md px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500"},null,40,se),[[x,e.value]])])]),o("span",{class:i(["px-2 py-1 text-xs font-medium rounded-full",e.is_public?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},d(e.is_public?"Público":"Privado"),3)])]))),128))])])):n("",!0)]))])])}}};export{le as default};
