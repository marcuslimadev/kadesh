import{d as e,r as t,c as a,a as r,b as s,e as l,i as o,t as n,h as i,p as d,u,o as c,N as v,j as p,g as m,n as b,F as x,l as g,B as f,J as y,q as h,k as w,C as j,m as k,f as _,s as C}from"./vue-_iW_wwAQ.js";import{a as A,u as P}from"./index-BiWDJfwt.js";import{_ as B}from"./StatusBadge-DFy4JmzA.js";import{b as M,d as D}from"./utils-CeLII1lI.js";import{l as E}from"./index-Ctu0mvSg.js";import{p as $}from"./projectService-4xyhWrQP.js";import{b as z}from"./bidService-CxYvGsWL.js";const R=e("projects",()=>{const e=t([]),r=t(null),s=t([]),l=t(!1),o=t({total:0,limit:20,offset:0,hasMore:!1}),n=a(()=>e.value.filter(e=>e.featured)),i=a(()=>e.value.filter(e=>"open"===e.status)),d=async(t={})=>{var a,r;l.value=!0;try{const a={limit:o.value.limit,offset:o.value.offset,...t},r=await A.get("/api/projects",{params:a});return 0===o.value.offset?e.value=r.data.projects:e.value.push(...r.data.projects),o.value={total:r.data.total,limit:r.data.limit,offset:r.data.offset,hasMore:r.data.projects.length===r.data.limit},{success:!0}}catch(s){return console.error("Fetch projects error:",s),{success:!1,error:(null==(r=null==(a=s.response)?void 0:a.data)?void 0:r.error)||"Erro ao carregar projetos"}}finally{l.value=!1}};return{projects:e,currentProject:r,userProjects:s,isLoading:l,pagination:o,featuredProjects:n,openProjects:i,fetchProjects:d,fetchProject:async e=>{var t,a;l.value=!0;try{const t=await A.get(`/api/projects/${e}`);return r.value=t.data.project,{success:!0,project:t.data.project}}catch(s){return console.error("Fetch project error:",s),{success:!1,error:(null==(a=null==(t=s.response)?void 0:t.data)?void 0:a.error)||"Erro ao carregar projeto"}}finally{l.value=!1}},createProject:async t=>{var a,r;l.value=!0;try{const a=(await A.post("/api/projects",t)).data.project;return e.value.unshift(a),s.value.unshift(a),{success:!0,project:a}}catch(o){return console.error("Create project error:",o),{success:!1,error:(null==(r=null==(a=o.response)?void 0:a.data)?void 0:r.error)||"Erro ao criar projeto"}}finally{l.value=!1}},updateProject:async(t,a)=>{var o,n,i;l.value=!0;try{const l=(await A.put(`/api/projects/${t}`,a)).data.project,n=e.value.findIndex(e=>e.id===t);-1!==n&&(e.value[n]=l);const i=s.value.findIndex(e=>e.id===t);return-1!==i&&(s.value[i]=l),(null==(o=r.value)?void 0:o.id)===t&&(r.value=l),{success:!0,project:l}}catch(d){return console.error("Update project error:",d),{success:!1,error:(null==(i=null==(n=d.response)?void 0:n.data)?void 0:i.error)||"Erro ao atualizar projeto"}}finally{l.value=!1}},deleteProject:async t=>{var a,o,n;l.value=!0;try{return await A.delete(`/api/projects/${t}`),e.value=e.value.filter(e=>e.id!==t),s.value=s.value.filter(e=>e.id!==t),(null==(a=r.value)?void 0:a.id)===t&&(r.value=null),{success:!0}}catch(i){return console.error("Delete project error:",i),{success:!1,error:(null==(n=null==(o=i.response)?void 0:o.data)?void 0:n.error)||"Erro ao deletar projeto"}}finally{l.value=!1}},fetchUserProjects:async(e="all")=>{var t,a;l.value=!0;try{const t={status:e,limit:50},a=await A.get("/api/projects/user/my-projects",{params:t});return s.value=a.data.projects,{success:!0}}catch(r){return console.error("Fetch user projects error:",r),{success:!1,error:(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.error)||"Erro ao carregar seus projetos"}}finally{l.value=!1}},searchProjects:async(e,t={})=>d({search:e,...t}),loadMoreProjects:async(e={})=>{if(o.value.hasMore&&!l.value)return o.value.offset+=o.value.limit,d(e)},resetPagination:()=>{o.value.offset=0,o.value.hasMore=!1},clearCurrentProject:()=>{r.value=null}}}),F={class:"bg-[#161821] border border-[rgba(212,175,55,0.24)] rounded-lg p-4 hover:shadow-[0_4px_20px_rgba(212,175,55,0.25)] hover:border-[#D4AF37] transition-all"},N={class:"flex items-start justify-between mb-3"},S={class:"flex items-center space-x-3"},q={class:"w-10 h-10 rounded-full bg-[rgba(212,175,55,0.15)] text-[#D4AF37] flex items-center justify-center text-sm font-semibold border border-[#D4AF37]"},V={class:"font-medium text-[#F5F5F5]"},I={class:"flex items-center text-xs text-[#C7C7C7]"},L={class:"text-right"},U={class:"text-2xl font-bold text-[#D4AF37]"},T={class:"text-xs text-[#8A8A8A]"},O={class:"mb-3"},H={class:"text-sm text-[#C7C7C7]"},J={class:"flex items-center justify-between text-xs text-[#8A8A8A] mb-3"},K={class:"flex items-center space-x-4"},W={class:"flex items-center"},G={key:0,class:"flex items-center"},Q={key:0,class:"flex gap-2"},X={key:1,class:"mt-2 p-2 bg-[rgba(34,197,94,0.15)] border border-[#22c55e] rounded text-sm text-[#22c55e]"},Y={key:2,class:"mt-2 p-2 bg-[rgba(239,68,68,0.15)] border border-[#ef4444] rounded text-sm text-[#ef4444]"},Z={__name:"BidCard",props:{bid:{type:Object,required:!0},showActions:{type:Boolean,default:!1}},emits:["accept","reject"],setup(e){const t=e=>{if(!e&&0!==e)return"Novo";const t=Number(e);return Number.isNaN(t)?"Novo":t.toFixed(1)},a=e=>{if(!e)return"Data n√£o dispon√≠vel";try{return M(new Date(e),{addSuffix:!0,locale:E})}catch(t){return"Data inv√°lida"}};return(u,c)=>{return s(),r("div",F,[l("div",N,[l("div",S,[l("div",q,n((m=e.bid.provider_name,m?m.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"?")),1),l("div",null,[l("p",V,n(e.bid.provider_name),1),l("div",I,[c[2]||(c[2]=l("svg",{class:"w-3 h-3 mr-1 text-[#D4AF37] fill-current",viewBox:"0 0 20 20"},[l("path",{d:"M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"})],-1)),l("span",null,n(t(e.bid.rating)),1),c[3]||(c[3]=l("span",{class:"mx-1"},"‚Ä¢",-1)),l("span",null,n(e.bid.total_projects||0)+" projetos",1)])])]),l("div",L,[l("p",U,n((p=e.bid.amount,p||0===p?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(p):"A combinar")),1),l("p",T,n((v=e.bid.delivery_time??e.bid.delivery_time_days,v?`${v} ${1===v?"dia":"dias"}`:"")),1)])]),l("div",O,[l("p",H,n(e.bid.proposal||e.bid.description),1)]),l("div",J,[l("div",K,[l("span",W,[c[4]||(c[4]=l("svg",{class:"w-3 h-3 mr-1 text-[#D4AF37]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),d(" "+n(a(e.bid.created_at)),1)]),e.bid.score?(s(),r("span",G,[c[5]||(c[5]=l("svg",{class:"w-3 h-3 mr-1 text-[#D4AF37]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1)),d(" Score: "+n(e.bid.score.toFixed(1)),1)])):o("",!0)]),i(B,{status:e.bid.status},null,8,["status"])]),e.showActions&&"pending"===e.bid.status?(s(),r("div",Q,[l("button",{onClick:c[0]||(c[0]=t=>u.$emit("accept",e.bid.id)),class:"flex-1 px-4 py-2 bg-[#22c55e] text-white rounded-md hover:bg-[#16a34a] transition-colors text-sm font-medium"}," Aceitar Proposta "),l("button",{onClick:c[1]||(c[1]=t=>u.$emit("reject",e.bid.id)),class:"px-4 py-2 border border-[rgba(212,175,55,0.24)] text-[#C7C7C7] rounded-md hover:bg-[#1A1A1A] transition-colors text-sm font-medium"}," Rejeitar ")])):o("",!0),"accepted"===e.bid.status?(s(),r("div",X," ‚úì Proposta aceita ")):o("",!0),"rejected"===e.bid.status?(s(),r("div",Y," ‚úó Proposta rejeitada ")):o("",!0)]);var v,p,m}}},ee={key:0,class:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-6"},te={class:"flex items-start justify-between"},ae={class:"flex-1"},re={class:"text-sm text-green-700 mb-4"},se={class:"bg-white border border-green-200 rounded p-3 mb-4"},le={class:"flex items-baseline gap-2"},oe={class:"text-2xl font-bold text-green-600"},ne={class:"text-sm text-gray-500"},ie={class:"flex items-center gap-3"},de=["disabled"],ue={key:0,class:"flex items-center justify-center gap-2"},ce={key:1,class:"flex items-center justify-center gap-2"},ve={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},pe={class:"bg-white rounded-lg shadow-xl max-w-md w-full p-6"},me={class:"text-gray-600 mb-6"},be={class:"text-green-600"},xe={class:"bg-yellow-50 border border-yellow-200 rounded p-3 mb-6"},ge={class:"text-sm text-yellow-800"},fe={class:"flex gap-3"},ye=["disabled"],he={__name:"ReleasePaymentButton",props:{projectId:{type:[Number,String],required:!0},paymentStatus:{type:String,required:!0},finalPrice:{type:Number,required:!0},isContractor:{type:Boolean,required:!0},providerName:{type:String,default:"o prestador"}},emits:["payment-released"],setup(e,{emit:i}){const c=e,v=i,p=u(),m=t(!1),b=t(!1),x=t(10),g=a(()=>c.finalPrice),f=a(()=>g.value*(x.value/100)),y=a(()=>g.value-f.value),h=a(()=>c.isContractor&&("escrow_hold"===c.paymentStatus||"pending"===c.paymentStatus)),w=e=>new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e),j=()=>{b.value=!0},k=async()=>{var e,t;try{m.value=!0;const e=await A.post(`/projects/${c.projectId}/release-payment`);e.data.success&&(v("payment-released",e.data),alert(`‚úÖ Pagamento liberado com sucesso!\n\nValor transferido: R$ ${w(y.value)}\nTaxa da plataforma: R$ ${w(f.value)}`),setTimeout(()=>{window.location.reload()},1500))}catch(a){console.error("Error releasing payment:",a),alert(`‚ùå Erro ao liberar pagamento: ${(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.error)||a.message}`)}finally{m.value=!1,b.value=!1}},_=()=>{p.push(`/support/dispute?project=${c.projectId}`)};return(t,a)=>h.value?(s(),r("div",ee,[l("div",te,[l("div",ae,[a[3]||(a[3]=l("div",{class:"flex items-center gap-2 mb-2"},[l("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),l("h3",{class:"text-lg font-semibold text-green-900"},"Projeto Conclu√≠do")],-1)),l("p",re,[d(" O prestador "+n(e.providerName)+" concluiu o trabalho. Revise a entrega e libere o pagamento de ",1),l("strong",null,"R$ "+n(w(g.value)),1),a[1]||(a[1]=d(". ",-1))]),l("div",se,[a[2]||(a[2]=l("p",{class:"text-xs text-gray-600 mb-1"},"üí∞ Valor a ser transferido:",-1)),l("div",le,[l("span",oe,"R$ "+n(w(y.value)),1),l("span",ne,"("+n(x.value)+"% taxa: R$ "+n(w(f.value))+")",1)])])])]),l("div",ie,[l("button",{onClick:j,disabled:m.value,class:"flex-1 px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors shadow-md"},[m.value?(s(),r("span",ce,[...a[5]||(a[5]=[l("svg",{class:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),d(" Processando... ",-1)])])):(s(),r("span",ue,[...a[4]||(a[4]=[l("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),d(" Liberar Pagamento ",-1)])]))],8,de),l("button",{onClick:_,class:"px-4 py-3 bg-white text-red-600 border-2 border-red-300 font-medium rounded-lg hover:bg-red-50 transition-colors"}," Reportar Problema ")]),b.value?(s(),r("div",ve,[l("div",pe,[a[9]||(a[9]=l("h3",{class:"text-xl font-bold text-gray-900 mb-4"},"Confirmar Libera√ß√£o de Pagamento",-1)),l("p",me,[a[6]||(a[6]=d(" Voc√™ est√° prestes a liberar ",-1)),l("strong",be,"R$ "+n(w(y.value)),1),d(" para "+n(e.providerName)+". Esta a√ß√£o √© irrevers√≠vel. ",1)]),l("div",xe,[l("p",ge,[a[7]||(a[7]=d(" ‚ö†Ô∏è ",-1)),a[8]||(a[8]=l("strong",null,"Aten√ß√£o:",-1)),d(" A taxa da plataforma de "+n(x.value)+"% (R$ "+n(w(f.value))+") ser√° deduzida automaticamente. ",1)])]),l("div",fe,[l("button",{onClick:a[0]||(a[0]=e=>b.value=!1),class:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"}," Cancelar "),l("button",{onClick:k,disabled:m.value,class:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400"}," Confirmar Libera√ß√£o ",8,ye)])])])):o("",!0)])):o("",!0)}},we={class:"min-h-screen bg-page py-8"},je={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ke={key:0,class:"text-center py-12"},_e={key:1,class:"bg-surface rounded-lg shadow-md p-8 text-center"},Ce={class:"mt-2 text-sm text-body"},Ae={class:"mt-6"},Pe={key:2,class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},Be={class:"lg:col-span-2 space-y-6"},Me={class:"bg-surface rounded-lg shadow-md p-6"},De={class:"flex items-start justify-between mb-4"},Ee={class:"flex-1"},$e={class:"text-3xl font-bold text-heading mb-2"},ze={class:"flex items-center gap-4 text-sm text-gray-500"},Re={class:"flex items-center"},Fe={class:"flex items-center"},Ne={class:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg mb-6"},Se={class:"text-2xl font-bold text-heading"},qe={class:"text-lg font-semibold text-heading"},Ve={key:0,class:"mt-2"},Ie={class:"flex items-center space-x-2"},Le={class:"text-body whitespace-pre-line"},Ue={key:0,class:"mt-6"},Te={class:"text-body whitespace-pre-line"},Oe={class:"mt-6"},He={class:"flex items-center justify-between mb-3"},Je={key:0,class:"flex items-center gap-2"},Ke={key:0,class:"grid gap-4 md:grid-cols-2"},We={class:"w-16 h-16 rounded-lg bg-gray-100 flex items-center justify-center overflow-hidden"},Ge=["src","alt"],Qe={key:1,class:"w-8 h-8 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Xe={class:"flex-1 min-w-0"},Ye={class:"text-sm font-semibold text-heading truncate"},Ze={class:"text-xs text-gray-500"},et={key:0},tt={class:"flex flex-wrap gap-2 mt-2"},at=["href"],rt=["disabled","onClick"],st={key:1,class:"p-4 border border-dashed rounded-xl text-sm text-gray-500 bg-gray-50"},lt={key:0,class:"text-body font-medium"},ot={key:1,class:"mt-6"},nt={class:"flex flex-wrap gap-2"},it={class:"bg-surface rounded-lg shadow-md p-6"},dt={class:"flex items-center justify-between"},ut={class:"flex items-center space-x-3"},ct={class:"text-right"},vt={class:"flex items-center justify-between mb-4"},pt={class:"text-lg font-semibold text-heading"},mt={class:"flex items-center gap-3"},bt={key:0,class:"relative"},xt={key:1,class:"mb-6 p-4 bg-gray-50 rounded-lg"},gt=["disabled"],ft={key:2,class:"text-center py-8"},yt={key:3,class:"space-y-4"},ht={key:4,class:"text-center py-8 text-gray-500"},wt={key:0,class:"text-sm mt-1"},jt={class:"lg:col-span-1 space-y-6"},kt={class:"bg-surface rounded-lg shadow-md p-6"},_t={class:"flex items-center mb-4"},Ct={class:"w-12 h-12 rounded-full bg-primary-100 text-primary-600 flex items-center justify-center text-lg font-semibold mr-3"},At={class:"font-medium text-heading"},Pt={class:"bg-surface rounded-lg shadow-md p-6"},Bt={class:"space-y-3"},Mt={class:"flex justify-between"},Dt={class:"text-sm font-medium text-heading"},Et={class:"flex justify-between"},$t={class:"text-sm font-medium text-heading"},zt={class:"flex justify-between"},Rt={key:0,class:"bg-surface rounded-lg shadow-md p-6"},Ft={class:"space-y-3"},Nt=["disabled"],St={key:1,class:"text-xs text-gray-500 text-center"},qt={key:2,class:"w-full px-4 py-2 border border-red-300 rounded-md text-sm font-medium text-red-700 bg-surface hover:bg-red-50 transition-colors"},Vt={key:1,class:"bg-surface rounded-lg shadow-md p-6 border-2 border-green-500"},It={class:"flex items-center space-x-3"},Lt={class:"w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center font-semibold"},Ut={class:"font-medium text-heading"},Tt={class:"text-sm text-green-600 font-semibold"},Ot={__name:"ProjectDetail",setup(e){const A=C(),F=u(),N=P();R();const S=t(null),q=t([]),V=t(!1),I=t(!1),L=t(null),U=t(!1),T=t(!1),O=t(null),H=t(null),J=t("score"),K=t(!1),W=t(null),G=t(!1),Q=t({amount:null,proposal:"",delivery_time:null}),X=a(()=>{var e;return(null==(e=S.value)?void 0:e.skills)?S.value.skills.split(",").map(e=>e.trim()).filter(Boolean):[]}),Y=a(()=>{var e,t;return(null==(e=N.user)?void 0:e.id)===(null==(t=S.value)?void 0:t.client_id)}),ee=a(()=>{var e;return N.isProvider&&"open"===(null==(e=S.value)?void 0:e.status)&&!Y.value});a(()=>{var e;return!!(null==(e=S.value)?void 0:e.deadline)&&new Date(S.value.deadline)<new Date});const te=a(()=>{if(!O.value)return null;const{days:e,hours:t,minutes:a,seconds:r,expired:s}=O.value;return s?{text:"Prazo encerrado",class:"text-red-600"}:e>0?{text:`${e}d ${t}h ${a}m`,class:e>2?"text-green-600":"text-yellow-600"}:t>0?{text:`${t}h ${a}m ${r}s`,class:t>6?"text-yellow-600":"text-orange-600"}:{text:`${a}m ${r}s`,class:"text-red-600 font-bold"}}),ae=a(()=>{if(!q.value||0===q.value.length)return[];const e=[...q.value];switch(J.value){case"price-low":return e.sort((e,t)=>(e.amount||0)-(t.amount||0));case"price-high":return e.sort((e,t)=>(t.amount||0)-(e.amount||0));case"date-new":return e.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at));case"date-old":return e.sort((e,t)=>new Date(e.created_at)-new Date(t.created_at));default:return e.sort((e,t)=>{const a=e.score||0,r=t.score||0;return r!==a?r-a:(e.amount||0)-(t.amount||0)})}}),re=a(()=>{var e;return(null==(e=S.value)?void 0:e.attachments)&&Array.isArray(S.value.attachments)?S.value.attachments:[]}),se=a(()=>q.value&&0!==q.value.length?q.value.find(e=>"accepted"===e.status):null),le=e=>{if(!e)return"Data n√£o dispon√≠vel";try{return M(new Date(e),{addSuffix:!0,locale:E})}catch(t){return"Data inv√°lida"}},oe=e=>{if(!e)return"N√£o especificado";try{return new Date(e).toLocaleString("pt-BR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return"Data inv√°lida"}},ne=e=>e||0===e?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e):"A combinar",ie=e=>{const t=$.getCategories().find(t=>t.value===e||t.label===e);return t?t.label:e},de=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"?",ue=e=>Boolean((null==e?void 0:e.mime_type)&&e.mime_type.startsWith("image/")),ce=async e=>{var t,a;if(!(null==(t=S.value)?void 0:t.id))return;const r=Array.from((null==(a=e.target)?void 0:a.files)||[]);if(r.length){G.value=!0;try{let e=0,t=0;for(const a of r)if(a.size>5242880)t++;else try{const r=await $.uploadAttachment(S.value.id,a);if(r.success){e++;const t=re.value;S.value.attachments=[...t,r.data.attachment]}else t++}catch(s){t++,console.error("Erro ao enviar anexo:",s)}}finally{G.value=!1,e.target&&(e.target.value="")}}},ve=()=>{var e;if(!(null==(e=S.value)?void 0:e.deadline))return void(O.value=null);const t=new Date(S.value.deadline),a=D(t,new Date);if(a<=0)return O.value={days:0,hours:0,minutes:0,seconds:0,expired:!0},void(H.value&&(clearInterval(H.value),H.value=null));const r=Math.floor(a/86400),s=Math.floor(a%86400/3600),l=Math.floor(a%3600/60),o=a%60;O.value={days:r,hours:s,minutes:l,seconds:o,expired:!1}},pe=async()=>{V.value=!0,L.value=null;try{const e=A.params.id,t=await $.getProject(e);t.success?(S.value=t.data.project,"open"===S.value.status&&S.value.deadline&&(H.value&&clearInterval(H.value),ve(),H.value=setInterval(ve,1e3)),await me()):L.value=t.error}catch(e){console.error("Error loading project:",e),L.value="Erro ao carregar projeto"}finally{V.value=!1}},me=async()=>{var e;if(null==(e=S.value)?void 0:e.id){I.value=!0;try{const e=await $.getProjectBids(S.value.id);e.success?(q.value=e.data.bids||[],S.value&&(S.value.bid_count=q.value.length)):console.error("Error loading bids:",e.error)}catch(t){console.error("Error loading bids:",t)}finally{I.value=!1}}},be=async()=>{if(N.isAuthenticated){if(N.isProvider&&Q.value.amount&&Q.value.proposal&&Q.value.delivery_time&&Q.value.proposal.trim()){T.value=!0;try{const e={project_id:S.value.id,amount:Q.value.amount,proposal:Q.value.proposal,delivery_time:Q.value.delivery_time};(await z.createBid(e)).success&&(U.value=!1,Q.value={amount:null,proposal:"",delivery_time:null},await me())}catch(e){console.error("Error submitting bid:",e)}finally{T.value=!1}}}else F.push("/login")},xe=async e=>{if(confirm("Tem certeza que deseja aceitar esta proposta? Isso encerrar√° o leil√£o."))try{(await z.acceptBid(S.value.id,e)).success&&await pe()}catch(t){console.error("Error accepting bid:",t)}},ge=async e=>{if(confirm("Tem certeza que deseja rejeitar esta proposta?"))try{(await z.rejectBid(e)).success&&await me()}catch(t){console.error("Error rejecting bid:",t)}},fe=async e=>{console.log("Payment released:",e),await pe()},ye=async()=>{if(0===q.value.length)return;const e=[...q.value].sort((e,t)=>(e.amount||0)-(t.amount||0))[0],t=`Encerrar o leil√£o agora?\n\nO vencedor ser√°: ${e.provider_name}\nValor: R$ ${new Intl.NumberFormat("pt-BR").format(e.amount)}\n\nEsta a√ß√£o n√£o pode ser desfeita.`;if(confirm(t)){K.value=!0;try{(await $.closeAuction(S.value.id)).success&&await pe()}catch(a){console.error("Error closing auction:",a)}finally{K.value=!1}}};return c(()=>{pe()}),v(()=>{H.value&&clearInterval(H.value)}),(e,t)=>{var a,u,c,v,C,A,P,M,D,E,z,R,F,H,ve,pe;const me=m("router-link");return s(),r("div",we,[l("div",je,[V.value?(s(),r("div",ke,[...t[5]||(t[5]=[l("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1),l("p",{class:"mt-4 text-body"},"Carregando projeto...",-1)])])):L.value?(s(),r("div",_e,[t[7]||(t[7]=l("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t[8]||(t[8]=l("h3",{class:"mt-4 text-lg font-medium text-heading"},"Erro ao carregar projeto",-1)),l("p",Ce,n(L.value),1),l("div",Ae,[i(me,{to:"/projects",class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700"},{default:p(()=>[...t[6]||(t[6]=[d(" Voltar para Projetos ",-1)])]),_:1})])])):S.value?(s(),r("div",Pe,[l("div",Be,[l("div",Me,[l("div",De,[l("div",Ee,[l("h1",$e,n(S.value.title),1),l("div",ze,[l("span",Re,[t[9]||(t[9]=l("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})],-1)),d(" "+n(ie(S.value.category)),1)]),l("span",Fe,[t[10]||(t[10]=l("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),d(" "+n(le(S.value.created_at)),1)])])]),i(B,{status:S.value.status},null,8,["status"])]),l("div",Ne,[l("div",null,[t[11]||(t[11]=l("p",{class:"text-sm text-body mb-1"},"Or√ßamento",-1)),l("p",Se,n(ne(S.value.budget)),1)]),l("div",null,[t[13]||(t[13]=l("p",{class:"text-sm text-body mb-1"},"Prazo de Entrega",-1)),l("p",qe,n(oe(S.value.deadline)),1),"open"===S.value.status&&te.value?(s(),r("div",Ve,[l("div",Ie,[(s(),r("svg",{class:b(["w-4 h-4",te.value.class]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[12]||(t[12]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])],2)),l("span",{class:b(["text-sm font-medium",te.value.class])},n(te.value.text),3)])])):o("",!0)])]),l("div",null,[t[14]||(t[14]=l("h2",{class:"text-lg font-semibold text-heading mb-3"},"Descri√ß√£o",-1)),l("p",Le,n(S.value.description),1)]),S.value.requirements?(s(),r("div",Ue,[t[15]||(t[15]=l("h2",{class:"text-lg font-semibold text-heading mb-3"},"Requisitos",-1)),l("p",Te,n(S.value.requirements),1)])):o("",!0),l("div",Oe,[l("div",He,[t[18]||(t[18]=l("h2",{class:"text-lg font-semibold text-heading"},"Arquivos Anexados",-1)),Y.value?(s(),r("div",Je,[l("input",{id:"detailAttachmentUpload",type:"file",class:"hidden",multiple:"",accept:"image/*,video/*,.pdf",onChange:ce},null,32),l("label",{for:"detailAttachmentUpload",class:b(["inline-flex items-center px-3 py-2 rounded-lg border border-amber-200 text-sm font-medium text-amber-700 bg-amber-50 hover:bg-amber-100 cursor-pointer disabled:opacity-50",{"pointer-events-none opacity-60":G.value}])},[t[16]||(t[16]=l("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)),d(" "+n(G.value?"Enviando...":"Adicionar Anexos"),1)],2),t[17]||(t[17]=l("p",{class:"text-xs text-gray-500"},"M√°x. 5MB por arquivo",-1))])):o("",!0)]),re.value.length?(s(),r("div",Ke,[(s(!0),r(x,null,g(re.value,e=>{return s(),r("div",{key:e.id,class:"flex items-center gap-4 p-4 border rounded-xl hover:border-primary-300 hover:bg-primary-50 transition"},[l("div",We,[ue(e)?(s(),r("img",{key:0,src:e.file_url,alt:e.original_name,class:"object-cover w-full h-full"},null,8,Ge)):(s(),r("svg",Qe,[...t[19]||(t[19]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h10M7 11h10M7 15h7"},null,-1)])]))]),l("div",Xe,[l("p",Ye,n(e.original_name),1),l("p",Ze,[d(n(e.mime_type||"Arquivo")+" ",1),e.file_size?(s(),r("span",et," ¬∑ "+n((a=e.file_size,a||0===a?a<1048576?`${(a/1024).toFixed(1)} KB`:`${(a/1048576).toFixed(1)} MB`:"")),1)):o("",!0)]),l("div",tt,[l("a",{href:e.file_url,target:"_blank",rel:"noopener",class:"text-xs font-semibold text-amber-600 hover:text-amber-800"}," Baixar / Abrir ",8,at),Y.value?(s(),r("button",{key:0,type:"button",class:"text-xs font-semibold text-red-600 hover:text-red-800 disabled:opacity-50",disabled:W.value===e.id,onClick:t=>(async e=>{var t;if(!(null==(t=S.value)?void 0:t.id)||!e)return;if(window.confirm("Remover este anexo? Essa a√ß√£o n√£o pode ser desfeita.")){W.value=e;try{if((await $.deleteAttachment(S.value.id,e)).success){const t=re.value.filter(t=>t.id!==e);S.value.attachments=t}}catch(a){console.error("Erro ao remover anexo:",a)}finally{W.value=null}}})(e.id)},n(W.value===e.id?"Removendo...":"Remover"),9,rt)):o("",!0)])])]);var a}),128))])):(s(),r("div",st,[t[20]||(t[20]=d(" Nenhum anexo enviado at√© o momento. ",-1)),Y.value?(s(),r("span",lt,"Use o bot√£o acima para subir arquivos de refer√™ncia.")):o("",!0)]))]),S.value.skills?(s(),r("div",ot,[t[21]||(t[21]=l("h2",{class:"text-lg font-semibold text-heading mb-3"},"Habilidades Necess√°rias",-1)),l("div",nt,[(s(!0),r(x,null,g(X.value,e=>(s(),r("span",{key:e,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-primary-100 text-primary-800"},n(e),1))),128))])])):o("",!0)]),l("div",it,["open"===S.value.status&&te.value&&!te.value.expired?(s(),r("div",{key:0,class:b(["mb-4 p-4 rounded-lg border-2",{"bg-green-50 border-green-300":(null==(a=O.value)?void 0:a.days)>2,"bg-yellow-50 border-yellow-300":(null==(u=O.value)?void 0:u.days)<=2&&(null==(c=O.value)?void 0:c.hours)>6,"bg-orange-50 border-orange-300":(null==(v=O.value)?void 0:v.hours)<=6&&(null==(C=O.value)?void 0:C.hours)>0,"bg-red-50 border-red-300":0===(null==(A=O.value)?void 0:A.hours)}])},[l("div",dt,[l("div",ut,[l("div",{class:b(["flex items-center justify-center w-10 h-10 rounded-full",{"bg-green-100":(null==(P=O.value)?void 0:P.days)>2,"bg-yellow-100":(null==(M=O.value)?void 0:M.days)<=2&&(null==(D=O.value)?void 0:D.hours)>6,"bg-orange-100":(null==(E=O.value)?void 0:E.hours)<=6&&(null==(z=O.value)?void 0:z.hours)>0,"bg-red-100":0===(null==(R=O.value)?void 0:R.hours)}])},[(s(),r("svg",{class:b(["w-6 h-6",te.value.class]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[22]||(t[22]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])],2))],2),t[23]||(t[23]=l("div",null,[l("p",{class:"font-semibold text-heading"},"Leil√£o Ativo"),l("p",{class:"text-sm text-body"},"Envie sua proposta antes do prazo")],-1))]),l("div",ct,[t[24]||(t[24]=l("p",{class:"text-sm text-body"},"Tempo restante",-1)),l("p",{class:b(["text-2xl font-bold",te.value.class])},n(te.value.text),3)])])],2)):o("",!0),l("div",vt,[l("h2",pt," Propostas ("+n(q.value.length)+") ",1),l("div",mt,[q.value.length>1?(s(),r("div",bt,[t[26]||(t[26]=l("label",{for:"bidSort",class:"sr-only"},"Ordenar propostas",-1)),f(l("select",{id:"bidSort","onUpdate:modelValue":t[0]||(t[0]=e=>J.value=e),class:"block pl-3 pr-10 py-2 text-sm border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md"},[...t[25]||(t[25]=[h('<option value="score">Melhor Score</option><option value="price-low">Menor Pre√ßo</option><option value="price-high">Maior Pre√ßo</option><option value="date-new">Mais Recentes</option><option value="date-old">Mais Antigas</option>',5)])],512),[[y,J.value]])])):o("",!0),ee.value?(s(),r("button",{key:1,onClick:t[1]||(t[1]=e=>U.value=!U.value),class:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors"},n(U.value?"Cancelar":"Enviar Proposta"),1)):o("",!0)])]),U.value&&ee.value?(s(),r("div",xt,[t[30]||(t[30]=l("h3",{class:"font-medium text-heading mb-4"},"Nova Proposta",-1)),l("form",{onSubmit:w(be,["prevent"]),class:"space-y-4"},[l("div",null,[t[27]||(t[27]=l("label",{for:"bidAmount",class:"block text-sm font-medium text-body mb-1"}," Valor da Proposta (R$) * ",-1)),f(l("input",{id:"bidAmount","onUpdate:modelValue":t[2]||(t[2]=e=>Q.value.amount=e),type:"number",min:"0",step:"0.01",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"0.00"},null,512),[[j,Q.value.amount,void 0,{number:!0}]])]),l("div",null,[t[28]||(t[28]=l("label",{for:"bidDescription",class:"block text-sm font-medium text-body mb-1"}," Descri√ß√£o da Proposta * ",-1)),f(l("textarea",{id:"bidDescription","onUpdate:modelValue":t[3]||(t[3]=e=>Q.value.proposal=e),rows:"4",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Descreva como voc√™ pretende realizar o projeto..."},null,512),[[j,Q.value.proposal]])]),l("div",null,[t[29]||(t[29]=l("label",{for:"bidDeliveryTime",class:"block text-sm font-medium text-body mb-1"}," Tempo de Entrega (dias) * ",-1)),f(l("input",{id:"bidDeliveryTime","onUpdate:modelValue":t[4]||(t[4]=e=>Q.value.delivery_time=e),type:"number",min:"1",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"7"},null,512),[[j,Q.value.delivery_time,void 0,{number:!0}]])]),l("button",{type:"submit",disabled:T.value,class:"w-full px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:bg-gray-400 transition-colors"},n(T.value?"Enviando...":"Enviar Proposta"),9,gt)],32)])):o("",!0),I.value?(s(),r("div",ft,[...t[31]||(t[31]=[l("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1),l("p",{class:"mt-2 text-body text-sm"},"Carregando propostas...",-1)])])):q.value.length>0?(s(),r("div",yt,[(s(!0),r(x,null,g(ae.value,e=>(s(),k(Z,{key:e.id,bid:e,"show-actions":Y.value,onAccept:xe,onReject:ge},null,8,["bid","show-actions"]))),128))])):(s(),r("div",ht,[t[32]||(t[32]=l("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t[33]||(t[33]=l("p",{class:"mt-2"},"Nenhuma proposta enviada ainda",-1)),ee.value?(s(),r("p",wt,"Seja o primeiro a enviar uma proposta!")):o("",!0)]))])]),l("div",jt,[l("div",kt,[t[35]||(t[35]=l("h3",{class:"text-lg font-semibold text-heading mb-4"},"Contratante",-1)),l("div",_t,[l("div",Ct,n(de(S.value.client_name)),1),l("div",null,[l("p",At,n(S.value.client_name),1),t[34]||(t[34]=l("p",{class:"text-sm text-gray-500"},"Contratante",-1))])])]),l("div",Pt,[t[39]||(t[39]=l("h3",{class:"text-lg font-semibold text-heading mb-4"},"Estat√≠sticas",-1)),l("div",Bt,[l("div",Mt,[t[36]||(t[36]=l("span",{class:"text-sm text-body"},"Propostas",-1)),l("span",Dt,n(S.value.bid_count||0),1)]),l("div",Et,[t[37]||(t[37]=l("span",{class:"text-sm text-body"},"Or√ßamento M√©dio",-1)),l("span",$t,n(ne(S.value.budget)),1)]),l("div",zt,[t[38]||(t[38]=l("span",{class:"text-sm text-body"},"Status",-1)),i(B,{status:S.value.status},null,8,["status"])])])]),(null==(F=_(N).user)?void 0:F.id)===S.value.client_id?(s(),r("div",Rt,[t[41]||(t[41]=l("h3",{class:"text-lg font-semibold text-heading mb-4"},"A√ß√µes",-1)),l("div",Ft,[t[40]||(t[40]=l("button",{class:"w-full px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-body bg-surface hover:bg-gray-50 transition-colors"}," Editar Projeto ",-1)),"open"===S.value.status&&q.value.length>0?(s(),r("button",{key:0,onClick:ye,disabled:K.value,class:"w-full px-4 py-2 border border-green-500 rounded-md text-sm font-medium text-green-700 bg-surface hover:bg-green-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},n(K.value?"Encerrando...":"üèÅ Encerrar Leil√£o e Selecionar Vencedor"),9,Nt)):o("",!0),"open"===S.value.status&&q.value.length>0?(s(),r("p",St," O vencedor ser√° o lance de menor valor ")):o("",!0),"open"===S.value.status?(s(),r("button",qt," Cancelar Projeto ")):o("",!0)])])):o("",!0),"in_progress"===S.value.status&&se.value?(s(),r("div",Vt,[t[42]||(t[42]=l("div",{class:"flex items-center space-x-2 mb-3"},[l("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),l("h3",{class:"text-lg font-semibold text-green-800"},"Vencedor do Leil√£o")],-1)),l("div",It,[l("div",Lt,n(de(se.value.provider_name)),1),l("div",null,[l("p",Ut,n(se.value.provider_name),1),l("p",Tt,n(ne(se.value.amount)),1)])])])):o("",!0),"awarded"===S.value.status||"escrow_hold"===S.value.payment_status?(s(),k(he,{key:2,"project-id":S.value.id,"payment-status":S.value.payment_status,"final-price":S.value.final_price||(null==(H=se.value)?void 0:H.amount)||S.value.budget,"is-contractor":(null==(ve=_(N).user)?void 0:ve.id)===S.value.client_id,"provider-name":(null==(pe=se.value)?void 0:pe.provider_name)||"o prestador",onPaymentReleased:fe},null,8,["project-id","payment-status","final-price","is-contractor","provider-name"])):o("",!0)])])):o("",!0)])])}}};export{Ot as default};
